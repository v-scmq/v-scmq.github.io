import{b as fe,d as H,a as ae,u as he,e as p,w as ye,f as be,g as me,h as ge,i as ve,j as ke,k as le,o as f,c as g,n as _,l as o,m as E,p as B,r as re,q as P,_ as we,t as V,s as A,v as u,x as _e,E as $e,y as Te,z as ie,A as J,B as Se,C as Ee,D as n,F as K,G as Q,H as O,I as Z,J as xe,K as Ce,L as $,M as ze,N as Ie,O as X,P as Be,Q as Ae,R as Ne,S as Fe,T as Le}from"./i-BqEWP96n.js";import{E as Pe,a as Re}from"./i-Q7mNWDM1.js";const De=fe({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:x=>x>=0&&x<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:H(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:H([String,Array,Function]),default:""},striped:Boolean,stripedFlow:Boolean,format:{type:H(Function),default:x=>`${x}%`}}),Me=["aria-valuenow"],Oe={viewBox:"0 0 100 100"},Ue=["d","stroke","stroke-linecap","stroke-width"],Ve=["d","stroke","opacity","stroke-linecap","stroke-width"],We={key:0},Ge=ae({name:"ElProgress"}),je=ae({...Ge,props:De,setup(x){const r=x,N={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},d=he("progress"),y=p(()=>({width:`${r.percentage}%`,animationDuration:`${r.duration}s`,background:M(r.percentage)})),C=p(()=>(r.strokeWidth/r.width*100).toFixed(1)),F=p(()=>["circle","dashboard"].includes(r.type)?Number.parseInt(`${50-Number.parseFloat(C.value)/2}`,10):0),L=p(()=>{const e=F.value,s=r.type==="dashboard";return`
          M 50 50
          m 0 ${s?"":"-"}${e}
          a ${e} ${e} 0 1 1 0 ${s?"-":""}${e*2}
          a ${e} ${e} 0 1 1 0 ${s?"":"-"}${e*2}
          `}),b=p(()=>2*Math.PI*F.value),k=p(()=>r.type==="dashboard"?.75:1),I=p(()=>`${-1*b.value*(1-k.value)/2}px`),R=p(()=>({strokeDasharray:`${b.value*k.value}px, ${b.value}px`,strokeDashoffset:I.value})),W=p(()=>({strokeDasharray:`${b.value*k.value*(r.percentage/100)}px, ${b.value}px`,strokeDashoffset:I.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),G=p(()=>{let e;return r.color?e=M(r.percentage):e=N[r.status]||N.default,e}),j=p(()=>r.status==="warning"?ye:r.type==="line"?r.status==="success"?be:me:r.status==="success"?ge:ve),q=p(()=>r.type==="line"?12+r.strokeWidth*.4:r.width*.111111+2),T=p(()=>r.format(r.percentage));function D(e){const s=100/e.length;return e.map((a,i)=>le(a)?{color:a,percentage:(i+1)*s}:a).sort((a,i)=>a.percentage-i.percentage)}const M=e=>{var s;const{color:t}=r;if(ke(t))return t(e);if(le(t))return t;{const a=D(t);for(const i of a)if(i.percentage>e)return i.color;return(s=a[a.length-1])==null?void 0:s.color}};return(e,s)=>(f(),g("div",{class:_([o(d).b(),o(d).m(e.type),o(d).is(e.status),{[o(d).m("without-text")]:!e.showText,[o(d).m("text-inside")]:e.textInside}]),role:"progressbar","aria-valuenow":e.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[e.type==="line"?(f(),g("div",{key:0,class:_(o(d).b("bar"))},[E("div",{class:_(o(d).be("bar","outer")),style:B({height:`${e.strokeWidth}px`})},[E("div",{class:_([o(d).be("bar","inner"),{[o(d).bem("bar","inner","indeterminate")]:e.indeterminate},{[o(d).bem("bar","inner","striped")]:e.striped},{[o(d).bem("bar","inner","striped-flow")]:e.stripedFlow}]),style:B(o(y))},[(e.showText||e.$slots.default)&&e.textInside?(f(),g("div",{key:0,class:_(o(d).be("bar","innerText"))},[re(e.$slots,"default",{percentage:e.percentage},()=>[E("span",null,V(o(T)),1)])],2)):P("v-if",!0)],6)],6)],2)):(f(),g("div",{key:1,class:_(o(d).b("circle")),style:B({height:`${e.width}px`,width:`${e.width}px`})},[(f(),g("svg",Oe,[E("path",{class:_(o(d).be("circle","track")),d:o(L),stroke:`var(${o(d).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-linecap":e.strokeLinecap,"stroke-width":o(C),fill:"none",style:B(o(R))},null,14,Ue),E("path",{class:_(o(d).be("circle","path")),d:o(L),stroke:o(G),fill:"none",opacity:e.percentage?1:0,"stroke-linecap":e.strokeLinecap,"stroke-width":o(C),style:B(o(W))},null,14,Ve)]))],6)),(e.showText||e.$slots.default)&&!e.textInside?(f(),g("div",{key:2,class:_(o(d).e("text")),style:B({fontSize:`${o(q)}px`})},[re(e.$slots,"default",{percentage:e.percentage},()=>[e.status?(f(),A(o($e),{key:1},{default:u(()=>[(f(),A(_e(o(j))))]),_:1})):(f(),g("span",We,V(o(T)),1))])],6)):P("v-if",!0)],10,Me))}});var qe=we(je,[["__file","progress.vue"]]);const He=Te(qe),Je={class:"row title card-item"},Ke={class:"col card-item grow",style:{position:"relative"}},U=(1<<22)+2,ce=1,de=2,Y=3,ee=4,te=5,Ye=ae({__name:"index",setup(x){const r=Array,N=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],d={1:"准备中",2:"等待中",3:"传输中",4:"已失败",5:"已完成"},y=ie(0),C=p(()=>y.value===0),F=p(()=>y.value===1),L=p(()=>y.value===2),b=J([]),k=J([]),I=J([]),R=ie(null),W=p(()=>{const s=y.value;return s<1?!1:(s<2?k:I).findIndex(a=>a.state<de)>=0}),G=p(()=>{const s=y.value;return s<1?!1:(s<2?k:I).findIndex(a=>a.state<te)>=0}),j=s=>{for(const t of s){const a=t.name,i=a.lastIndexOf(".");k.push({id:"",name:a,state:ce,path:"root",size:t.size,type:t.type,part:Math.ceil(t.size/U),_type:i>0?a.slice(i+1):"unknown",_size:`${(t.size/1024/1024).toFixed(2)}MB`,_file:t})}},q=async()=>{const s=k.filter(t=>t.state===ce);s.forEach(t=>t.state=de);for(const t of s){t.state=Y;const{name:a,type:i,size:l,part:w}=t;let m=0;const h=v=>{t._rate=(m+v)/t.size*100>>0},c=t._file;if(w<2){const z=await X(c,i,{name:a,size:l,length:l},h);t.state=z.error?ee:te;continue}const S=new r(w).fill(1).map((v,z)=>c.slice(v=z*U,v+U)),se=S[0].size,ne=await X(S[0],i,{name:a,size:l,length:se},h);if(ne.error){t.state=ee;continue}const pe=ne.data;let oe=!1;m+=se;for(let v=2;v<=w;++v){const z=S[v-1],ue=z.size;if((await X(z,i,{id:pe,part:v,length:ue},h)).error){oe=!0;break}m+=z.size}t.state=oe?ee:te}},T=s=>{s.preventDefault();const t=s.type;if(t==="drop"||t==="change"){const a=s.target,i=s.dataTransfer,l=(i?i.files:a.files)||[],w=new r(l.length).fill(null).map((m,h)=>l[h]);a.value&&(a.value=""),j(w),y.value=1}},D=()=>{const s=Z.service({lock:!0});xe().then(t=>{s.close(),b.splice(0,b.length,...t.data||[])})};Se(()=>{window.addEventListener("dragover",T),window.addEventListener("drop",T),D()}),Ee(()=>{window.removeEventListener("dragover",T),window.removeEventListener("drop",T)});const M=async s=>{const t=Z.service({lock:!0}),a=s.id,i=Math.ceil(s.size/U),l=new Array(i);for(let c=1;c<=i;++c){const S=await Be({id:a,part:c});if(S)l[c-1]=await S.blob();else return Ae.error("下载失败！"),t.close()}const w=new Blob(l,{type:s.type}),m=URL.createObjectURL(w),h=document.createElement("a");h.href=m,h.download=s.name,h.click(),URL.revokeObjectURL(m),t.close()},e=({id:s})=>{const t=Z.service({lock:!0});Ne([s]).then(({data:a})=>{t.close();const i=a?b.findIndex(l=>l.id===s):-1;i>-1&&b.splice(i,1)})};return(s,t)=>{const a=Fe,i=Ce,l=Re,w=Le,m=Pe,h=He;return f(),g(O,null,[E("div",Je,[n(i,null,{default:u(()=>[n(a,{type:"primary",disabled:C.value,onClick:t[0]||(t[0]=c=>y.value=0)},{default:u(()=>[$("文件管理")]),_:1},8,["disabled"]),n(a,{type:"primary",disabled:F.value,onClick:t[1]||(t[1]=c=>y.value=1)},{default:u(()=>[$("上传任务")]),_:1},8,["disabled"]),n(a,{type:"primary",disabled:L.value,onClick:t[2]||(t[2]=c=>y.value=2)},{default:u(()=>[$("下载任务")]),_:1},8,["disabled"])]),_:1}),n(i,{style:{"margin-left":"auto"}},{default:u(()=>[C.value?(f(),g(O,{key:0},[n(a,{type:"primary",onClick:D},{default:u(()=>[$("刷新")]),_:1}),n(a,{type:"primary",onClick:t[3]||(t[3]=c=>R.value.click())},{default:u(()=>[$("选择文件")]),_:1})],64)):P("",!0),W.value?(f(),A(a,{key:1,type:"primary",onClick:q},{default:u(()=>[$("全部开始")]),_:1})):P("",!0),G.value?(f(),A(a,{key:2,type:"danger"},{default:u(()=>[$("全部取消")]),_:1})):P("",!0)]),_:1}),E("input",{hidden:"",type:"file",multiple:"",ref_key:"fileRef",ref:R,onChange:T},null,544)]),E("div",Ke,[K(n(m,{height:"100%",border:"",style:{flex:"1",width:"100%"},data:b,"empty-text":"选择或拖拽文件以上传"},{default:u(()=>[n(l,{type:"index",label:"序号",width:"80"}),n(l,{prop:"name",label:"名称","class-name":"cell--nowrap"}),n(l,{prop:"_size",label:"大小",width:"100"}),n(l,{prop:"_type",label:"类型",width:"80"}),n(l,{prop:"create",label:"创建时间",width:"150"}),n(l,{prop:"update",label:"更新时间",width:"150"}),n(l,{label:"操作",width:"108",align:"center"},{default:u(({row:c})=>[n(a,{type:"primary",circle:"",icon:o(ze),onClick:S=>M(c)},null,8,["icon","onClick"]),n(w,{width:"256",title:"确定删除吗，删除后将无法恢复？",onConfirm:S=>e(c)},{reference:u(()=>[n(a,{type:"danger",circle:"",icon:o(Ie)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),[[Q,C.value]]),K(n(m,{height:"100%",border:"",style:{flex:"1",width:"100%"},data:k},{default:u(()=>[n(l,{type:"selection",width:"40",align:"center"}),n(l,{type:"index",label:"序号",width:"80"}),n(l,{prop:"name",label:"名称","class-name":"cell--nowrap"}),n(l,{label:"进度",width:"220",align:"center"},{default:u(({row:c})=>[c.state===Y?(f(),A(h,{key:0,"text-inside":!0,"stroke-width":26,percentage:c._rate,color:N},null,8,["percentage"])):(f(),g(O,{key:1},[$(V(d[c.state]),1)],64))]),_:1}),n(l,{prop:"_type",label:"类型",width:"80"}),n(l,{prop:"_size",label:"大小",width:"100"})]),_:1},8,["data"]),[[Q,F.value]]),K(n(m,{height:"100%",border:"",style:{flex:"1",width:"100%"},data:I},{default:u(()=>[n(l,{type:"selection",width:"40",align:"center"}),n(l,{type:"index",label:"序号",width:"80"}),n(l,{prop:"name",label:"名称","class-name":"cell--nowrap"}),n(l,{label:"进度",width:"220",align:"center"},{default:u(({row:c})=>[c.state===Y?(f(),A(h,{key:0,"text-inside":!0,"stroke-width":26,percentage:c._rate,color:N},null,8,["percentage"])):(f(),g(O,{key:1},[$(V(d[c.state]),1)],64))]),_:1}),n(l,{prop:"_type",label:"类型",width:"80"}),n(l,{prop:"_size",label:"大小",width:"100"})]),_:1},8,["data"]),[[Q,L.value]])])],64)}}});export{Ye as default};
