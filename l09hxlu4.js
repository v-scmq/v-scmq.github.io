import{d as he,c as x,o as v,a2 as le,r as g,m as L,T as Re,ah as He,ai as Te,aj as Se,a as j,f as fe,ak as se,ab as Y,p as We,V as _e,w as we,al as Le,b as Ve,e as $e,F as ee,g as re,v as ve,h as ge,t as pe}from"./e3hakuts.js";const me="update:modelValue",ye=he({__name:"CCheckbox",props:{modelValue:Boolean,indeterminate:Boolean,disabled:Boolean},emits:[me],setup(p,{emit:X}){const C=p,R=X,T=H=>{H.stopPropagation(),!C.disabled&&R(me,!C.modelValue)};return(H,B)=>(v(),x("span",{class:le(["c-checkbox",{checked:p.modelValue,none:p.indeterminate,disabled:p.disabled}]),onClick:T},null,2))}}),Ne={class:"c-scrollbar"},de="end-reached",ke="resize",xe="scroll",k=null,Ke=he({__name:"CScrollbar",props:{fillWidth:{},fillHeight:{}},emits:[de,ke,xe],setup(p,{emit:X}){let C,R,T,H;const{max:B}=Math,Z=setTimeout,r=p,F=X,h=g(k),A=g(k),V=g(k),D=g(k),O=g(k),z=g(k),m=g({sw:0,w:0,l:0,x:!1,sh:0,h:0,t:0,y:!1}),oe=L(()=>{const{sw:s,w:a,l:n,x:c}=m.value,d=c?B(a/s*100,20):0;return c?{width:`${d}%`,left:`${n/(s-a)*(100-d)}%`}:{}}),$=L(()=>{const{sh:s,h:a,t:n,y:c}=m.value,d=c?B(a/s*100,20):0;return c?{height:`${d}%`,top:`${n/(s-a)*(100-d)}%`}:{}}),I=L(()=>{let{fillWidth:s,fillHeight:a}=r;return{width:s?q(s)?`${s}px`:s:k,height:a?q(a)?`${a}px`:a:k}}),q=s=>typeof s=="number",G=()=>{const{scrollWidth:s,clientWidth:a,scrollLeft:n,scrollHeight:c,clientHeight:d,scrollTop:b}=h.value;m.value={sw:s,w:a,l:n,x:s>a,sh:c,h:d,t:b,y:c>d}},S=s=>{s.stopPropagation()},y=s=>{G(),F(xe,s)},W=s=>{if(s.deltaY<=0)return;const{clientHeight:a,scrollHeight:n,scrollTop:c}=h.value;c>=n-a-1&&(C&&clearTimeout(C),C=Z(()=>{C=k,F(de,de)},500))},J=s=>{const a=h.value,n=s.currentTarget;if(n===O.value){const c=V.value.offsetHeight,d=s.offsetY-c/2,b=n.offsetHeight-c,_=a.scrollHeight-a.offsetHeight;a.scrollTop=d/b*_}if(n===z.value){const c=D.value.offsetWidth,d=s.offsetX-c/2,b=n.offsetWidth-c,_=a.scrollWidth-a.offsetWidth;a.scrollLeft=d/b*_}},Q=s=>{s.stopImmediatePropagation();let a=!0;const n=document,c="onselectstart",d="mousemove",b="mouseup",_="EventListener",t=`add${_}`,l=`remove${_}`,e=n[c],o=h.value,{clientX:i,clientY:E,currentTarget:f}=s,{scrollLeft:u,scrollTop:w}=o,N=P=>{if(a)if(f===V.value){const K=P.clientY-E,ae=O.value.offsetHeight,ie=f.offsetHeight,ce=K/(ae-ie),ne=o.scrollHeight-o.clientHeight;o.scrollTop=w+ce*ne}else{const K=P.clientX-i,ae=z.value.offsetWidth,ie=f.offsetWidth,ce=K/(ae-ie),ne=o.scrollWidth-o.clientWidth;o.scrollLeft=u+ce*ne}},M=()=>{a=!1,n[c]=e,n[l](d,N),n[l](b,M)};n[c]=()=>!1,n[t](d,N),n[t](b,M)};return Re(()=>{R=new ResizeObserver(()=>{G(),F(ke,h.value)}),R.observe(h.value),R.observe(A.value)}),He(()=>{T=m.value.l,H=m.value.t}),Te(()=>(T>0||H>0)&&Z(()=>{h.value.scrollTop=H,h.value.scrollLeft=T,T=H=k})),Se(()=>{R.disconnect(),R=k}),(s,a)=>(v(),x("div",Ne,[j("div",{class:"scroll-wrapper",ref_key:"scrollWrapperRef",ref:h,onScroll:y,onTouchend:W,onWheel:W},[j("div",{class:"scroll-fill",ref_key:"scrollViewRef",ref:A,style:Y(I.value)},[se(s.$slots,"default")],4),se(s.$slots,"extra")],544),m.value.x?(v(),x("div",{key:0,class:"c-track x",ref_key:"trackXRef",ref:z,onClick:J},[j("div",{ref_key:"thumbXRef",ref:D,class:"c-thumb",style:Y(oe.value),onMousedown:Q,onClick:S},null,36)],512)):fe("",!0),m.value.y?(v(),x("div",{key:1,class:"c-track y",ref_key:"trackYRef",ref:O,onClick:J},[j("div",{ref_key:"thumbYRef",ref:V,class:"c-thumb",style:Y($.value),onMousedown:Q,onClick:S},null,36)],512)):fe("",!0)]))}}),Ye=["data-row"],Fe="end-reached",be="row-click",Ee="row-click",te="left",Ce="center",U="right",ue=null,De=he({__name:"CTable",props:{cellHeight:{type:Number,default:36},selectKey:{type:String,default:"_check_"},columns:{type:Array,required:!0},data:{type:Array,required:!0}},emits:[Fe,be,Ee],setup(p,{emit:X}){const C=parseInt,R=parseFloat,{ceil:T,floor:H,max:B,round:Z}=Math,r=p,F=X,h=g(0),A=We([]),V=g(-1),D=g([]),O=L(()=>(r.data.length+1)*r.cellHeight),z=L(()=>D.value.reduce((t,l)=>t+l,0)),m=L(()=>{let t="m",l=D.value,{data:e,columns:o}=r,i,E,f=o.map(u=>({...u,isChoice:E=u.type==="choice",title:(i=u.type==="index")?u.title||e.length:u.title,get:E?void 0:i?J:Q})).sort((u,w)=>(u.fixed||t).localeCompare(w.fixed||t));return f.forEach((u,w,N)=>{!u.fixed&&(N=f[w-1])?.fixed&&(N.isFixedLast=!0),!u.fixed&&(N=f[w+1])?.fixed&&(N.isFixedFirst=!0),u.fixed===te&&(u.pos={left:`${l.reduce((M,P,K)=>M+(K<w?P:0),0)}px`}),u.fixed===U&&(u.pos={right:`${l.reduce((M,P,K)=>M+(K>w?P:0),0)}px`})}),f}),oe=L(()=>({gridTemplateColumns:m.value.map(t=>t.width||"1fr").join(" ")})),$=L(()=>{let{data:t,selectKey:l}=r,e=t.reduce((i,E)=>i+(E[l]?1:0),0),o=t.length;return{checked:o>0&&o===e,disabled:o<1,none:e>0&&e<o}}),I=g(ue),q=g(!0),G=g(!0);let S=0,y,W;const J=(t,l)=>(l=++l+h.value)<10?`0${l}`:l,Q=(t,l,e)=>t[e.field],s=()=>{let t=r.data,l=t.length,{scrollLeft:e=0,scrollTop:o=0,scrollWidth:i=0,clientWidth:E=0}=y||{},f=l<=S?0:T(o/r.cellHeight);q.value=e<1,G.value=Z(e)>=i-E,A.splice(0,A.length,...t.slice(f,f+S)),h.value=f},a=t=>{let{data:l,selectKey:e}=r,o,i;if(l.length){o=typeof t=="boolean"?t:!$.value.checked;for(i of l)i[e]=o}},n=t=>{let l=t.key.toUpperCase();l=="PAGEUP"&&(y.scrollTop-=r.cellHeight*S),l=="PAGEDOWN"&&(y.scrollTop+=r.cellHeight*S),l=="ARROWUP"&&(y.scrollTop-=r.cellHeight),l=="ARROWDOWN"&&(y.scrollTop+=r.cellHeight),l=="HOME"&&y.scrollTo(0,0),l=="END"&&y.scrollTo(0,O.value),l=="A"&&t.ctrlKey&&r.columns.some(e=>e.type==="choice")&&a(!$.value.checked)},c=t=>{let{target:l,currentTarget:e}=t,o=l===e?ue:l.closest(".cell")?.dataset.row;return o?C(o):-1},d=t=>{let l=t.detail,e=c(t);e>=0&&l<=2&&F(l<2?be:Ee,r.data,e+h.value)},b=t=>V.value=c(t),_=t=>{y=t,S=B(H(t.clientHeight/r.cellHeight)-1,0),s()};return Re(()=>{W=new ResizeObserver(()=>{D.value=getComputedStyle(I.value).gridTemplateColumns.split(" ").map(t=>R(t)||0)}),W.observe(I.value)}),_e(()=>{W&&W.disconnect(),y=W=ue}),we(Le(r.data)?r.data:()=>r.data,s),(t,l)=>(v(),x("div",{class:le(["c-table",{[te]:q.value,[U]:G.value}]),tabindex:"0",onKeydown:n,style:Y({"--cell-height":`${p.cellHeight}px`})},[Ve(Ke,{class:"table-inner","fill-width":z.value,"fill-height":O.value,onResize:_,onScroll:s,onEndReached:F},{extra:$e(()=>[j("div",{class:"grid",ref_key:"gridRef",ref:I,style:Y(oe.value),onClick:d,onPointermove:b,onPointerleave:l[0]||(l[0]=e=>V.value=-1)},[(v(!0),x(ee,null,re(m.value,(e,o)=>(v(),x("div",{class:le(["cell th",{flex:e.flex,right:(e.thAlign||e.align)===U,center:(e.thAlign||e.align)===Ce,"fix-left":e.fixed===te,"fix-right":e.fixed===U,end:e.isFixedLast,start:e.isFixedFirst}]),key:o,style:Y(e.pos)},[e.isChoice?(v(),ve(ye,{key:0,"model-value":$.value.checked,disabled:$.value.disabled,indeterminate:$.value.none,onClick:a},null,8,["model-value","disabled","indeterminate"])):se(t.$slots,`h-${e.field}`,{key:1},()=>[ge(pe(e.title),1)])],6))),128)),(v(!0),x(ee,null,re(A,(e,o)=>(v(),x(ee,{key:o},[(v(!0),x(ee,null,re(m.value,(i,E)=>(v(),x("div",{class:le(["cell",{flex:i.flex,right:(i.align||i.thAlign)===U,center:(i.align||i.thAlign)===Ce,selected:e[p.selectKey],hover:V.value===o,odd:(o&1)<1,"fix-left":i.fixed===te,"fix-right":i.fixed===U,end:i.isFixedLast,start:i.isFixedFirst}]),key:`${o}-${E}`,"data-row":o,style:Y(i.pos)},[i.isChoice?(v(),ve(ye,{key:0,modelValue:e[p.selectKey],"onUpdate:modelValue":f=>e[p.selectKey]=f},null,8,["modelValue","onUpdate:modelValue"])):se(t.$slots,i.field,{key:1,row:e,idx:o+h.value},()=>[ge(pe(i.get(e,o,i)),1)])],14,Ye))),128))],64))),128))],36)]),_:3},8,["fill-width","fill-height"])],38))}});export{De as _,ye as a};
