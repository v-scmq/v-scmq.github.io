import{d as pe,r as me,n as h,m as I,p as fe,s as ve,v as ye,c as k,a as he,x as D,y as _,f as p,b as w,z as Q,_ as _e,F as P,e as r,A as z,i as X,B as ge,l as Z,C as ke,D as ee,E as we,G as xe,o as n,h as d,t as x,H as U,I as Ee}from"./ev20qhq0.js";import{E as Te}from"./kvnh6jjx.js";import{E as Ce}from"./dv7y6ted.js";import{_ as N}from"./fa0sh75k.js";import{d as Ae}from"./mpwglf32.js";const Se={class:"col card-item grow",style:{position:"relative"}},be={class:"row"},Fe={key:0,class:"row"},Ie={key:1,class:"row"},De={key:1,class:"row"},Pe={key:2,class:"row"},ze=0,te=1,R=2,T=3,ae=4,Ue="您的浏览器不支持文件系统API",Oe=pe({__name:"File",setup(Ne){const C=Set,B=showOpenFilePicker,L=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],V={0:"准备中",1:"已暂停",2:"已失败",3:"等待中",4:"传输中"},A=["文件管理","上传列表","下载列表"].map((e,a)=>({title:e,value:a})),m=me(A[0].value),M=h(()=>m.value===0),S=h(()=>m.value===1),O=h(()=>m.value===2),G=[{type:"choice",width:"32px",fixed:"left"},{type:"index",title:"序号",width:"60px",fixed:"left",align:"center"},{title:"名称",field:"name",width:"minmax(160px, 1fr)"},{title:"大小",field:"_size",width:"94px",thAlign:"center",align:"right"},{title:"类型",field:"_type",width:"60px",align:"center"},{title:"创建时间",field:"create",width:"144px",align:"center"},{title:"更新时间",field:"update",width:"144px",align:"center"}],q=[...G.slice(0,3),{title:"进度",field:"state",width:"minmax(160px, 220px)",align:"center"},{title:"类型",field:"_type",width:"60px",align:"center"},{title:"大小",field:"_size",width:"90px",thAlign:"center",align:"right"}],le=q,f=I([]),o=I([]),s=I([]),H={0:f,1:o,2:s},b=h(()=>H[m.value].length<1),c=h(()=>H[m.value].filter(e=>e._check_)),g=h(()=>c.value.length>0),E=h(()=>g.value?"":"全部"),$=h(()=>{let e=c.value;return e=e.length?e:S.value?o:s,e.some(a=>a.state<T)}),j=h(()=>{let e=c.value;return e=e.length?e:S.value?o:s,e.some(a=>a.state>R)}),F=new Worker(new URL("/6f716bdb.js",import.meta.url),{type:"module"}),v=e=>F.postMessage(e),u=()=>{let e,a;for(e of[f,o,s])for(a of e)delete a._check_},se=async()=>{if(!B)return U(Ue);try{const e=await B({multiple:!0});v({k:"b",v:e}),u(),m.value=A[1].value}catch{}},ne=async()=>{let e=(g.value?c.value:o).filter(t=>t.state<T);if((await Promise.all(e.map(t=>t.handle.requestPermission()))).some(t=>t!=="granted"))return U("必须授予文件读取权限，才能够继续！");u(),e.forEach(t=>t.state=T),v({k:"c",v:e.map(t=>({...t}))})},W=async()=>{let e=(g.value?c.value:o).filter(a=>a.state>R);u(),e.forEach(a=>a.state=te),v({k:"c",v:e.map(a=>({...a}))})},oe=async()=>{let e=c.value.map(t=>t.id),a=new C(e);u();for(let t=o.length-1;t>=0;--t)a.has(o[t].id)&&o.splice(t,1);v({k:"d",v:e})},ie=async()=>{let e=c.value,a=new C(s.map(i=>i.id)),t=e.filter(i=>a.has(i.id)).map(i=>i.name),l=e.filter(i=>!a.has(i.id)).map(i=>({id:i.id,name:i.name,part:0,size:i.size,state:ze,rate:0,_type:i._type,_size:i._size}));t.length&&U(`${t.join(";")}已经在下载任务列表，不可重复操作！`),l.length&&(s.push(...l),v({k:"e",v:l}),u(),m.value=A[2].value)},re=async()=>{let e=(g.value?c.value:s).filter(a=>a.state<T);u(),e.forEach(a=>a.state=T),v({k:"f",v:e.map(a=>({...a}))})},Y=async()=>{let e=(g.value?c.value:s).filter(a=>a.state>R);u(),e.forEach(a=>a.state=te),v({k:"f",v:e.map(a=>({...a}))})},de=async()=>{let e=c.value.map(t=>t.id),a=new C(e);u();for(let t=s.length-1;t>=0;--t)a.has(s[t].id)&&s.splice(t,1);v({k:"g",v:e})},ce=()=>{Ee("注意删除后不能恢复，确定删除？","确认删除？").then(()=>{X();let e=c.value.map(t=>t.id),a=new C(e);u(),ee(e).then(({data:t})=>{for(let l=t?f.length-1:-1;l>=0;--l)a.has(f[l].id)&&f.splice(l,1);Z()})})},J=()=>{X(),ge().then(e=>{f.splice(0,f.length,...e.data||[]),Z()})},K=(e,a)=>{let t=(a?s:o).find(l=>l.id===e.id);t&&xe(t,e)},ue={a([e,a]){o.push(...e),s.push(...a)},b(e){o.push(...e)},c(e){K(e,0)},d(e){if(ke(e))return ee(e);let a=o.findIndex(t=>t.id===e);if(a>-1){let t=o.splice(a,1)[0],l="***";f.push({id:t.rid,part:t.part,path:t.path,name:t.name,type:t.type,size:t.size,create:l,update:l,_type:t._type,_size:t._size})}},f(e){K(e,1)},g(e){let a=s.findIndex(l=>l.id===e),t=a>-1&&s.splice(a,1)[0];t?.rate>99&&navigator.storage.getDirectory().then(l=>l.getDirectoryHandle("a")).then(l=>l.getFileHandle(e)).then(l=>l.getFile()).then(l=>Ae(l,t.name))}};return fe(()=>{F.onmessage=({data:e})=>{ue[e.k](e.v)},v({k:"a",v:ve()}),J()}),ye(()=>{W(),Y(),F?.terminate()}),(e,a)=>{const t=we,l=Ce,i=Te;return n(),k("div",Se,[he("div",be,[w(_e,{modelValue:m.value,"onUpdate:modelValue":[a[0]||(a[0]=y=>m.value=y),u],items:Q(A),style:{"margin-right":"auto"}},null,8,["modelValue","items"]),M.value?(n(),k(P,{key:0},[g.value?(n(),k("div",Fe,[w(t,{round:"",type:"primary",onClick:ie},{default:r(()=>a[1]||(a[1]=[d("下载")])),_:1}),w(t,{round:"",type:"danger",onClick:ce},{default:r(()=>a[2]||(a[2]=[d("删除")])),_:1})])):(n(),k("div",Ie,[w(t,{round:"",type:"primary",onClick:J},{default:r(()=>a[3]||(a[3]=[d("刷新")])),_:1}),w(t,{round:"",type:"primary",onClick:se},{default:r(()=>a[4]||(a[4]=[d("上传")])),_:1})]))],64)):p("",!0),S.value&&o.length?(n(),k("div",De,[$.value?(n(),_(t,{key:0,round:"",type:"primary",onClick:ne},{default:r(()=>[d(x(E.value)+"开始",1)]),_:1})):p("",!0),j.value?(n(),_(t,{key:1,round:"",type:"primary",onClick:W},{default:r(()=>[d(x(E.value)+"暂停",1)]),_:1})):p("",!0),g.value?(n(),_(t,{key:2,round:"",type:"danger",onClick:oe},{default:r(()=>[d(x(E.value)+"取消",1)]),_:1})):p("",!0)])):p("",!0),O.value&&s.length?(n(),k("div",Pe,[$.value?(n(),_(t,{key:0,round:"",type:"primary",onClick:re},{default:r(()=>[d(x(E.value)+"开始",1)]),_:1})):p("",!0),j.value?(n(),_(t,{key:1,round:"",type:"primary",onClick:Y},{default:r(()=>[d(x(E.value)+"暂停",1)]),_:1})):p("",!0),g.value?(n(),_(t,{key:2,round:"",type:"danger",onClick:de},{default:r(()=>[d(x(E.value)+"取消",1)]),_:1})):p("",!0)])):p("",!0)]),D(w(N,{columns:G,data:f},null,8,["data"]),[[z,M.value&&!b.value]]),D(w(N,{columns:q,data:o},{state:r(({row:y})=>[y.state===ae?(n(),_(l,{key:0,"text-inside":!0,"stroke-width":26,percentage:y.rate,color:L},null,8,["percentage"])):(n(),k(P,{key:1},[d(x(V[y.state]),1)],64))]),_:1},8,["data"]),[[z,S.value&&!b.value]]),D(w(N,{columns:Q(le),data:s},{state:r(({row:y})=>[y.state===ae?(n(),_(l,{key:0,"text-inside":!0,"stroke-width":26,percentage:y.rate,color:L},null,8,["percentage"])):(n(),k(P,{key:1},[d(x(V[y.state]),1)],64))]),_:1},8,["columns","data"]),[[z,O.value&&!b.value]]),b.value?(n(),_(i,{key:0,style:{flex:"1"}})):p("",!0)])}}});export{Oe as default};
