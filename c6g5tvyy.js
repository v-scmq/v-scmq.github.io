const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["jvselvnq.js","dvuu6xne.js","be6shyp5.css","lusim3ka.js","dgso851w.js","mu2w5lvc.js","h72yjdwi.css","e816ckjj.js","howdarek.css","np029d02.js","o0va2ham.js","6yira59c.css","ny6gix59.css","ep0kgyhi.css","bsnhfarp.css"])))=>i.map(i=>d[i]);
import{d as me,u as ce,r as m,m as pe,n as ve,p as fe,s as _e,w as ye,c as P,b as l,f as J,v as T,e as d,x as k,y as ge,a as u,z as be,A as we,E as Ve,B as Ee,o as p,F as H,g as X,h as C,C as xe,D as ke,G as Ce,H as K,i as _,I as Le,l as f,J as j,K as Y,L as M,M as Ne,_ as r,N as he,O as Z,P as Ie,Q as Re,R as Ae,S as Pe}from"./dvuu6xne.js";import{E as Te,a as De,b as Oe}from"./e816ckjj.js";import{E as Ue}from"./idigc1gg.js";import{E as Me,a as $e}from"./mu2w5lvc.js";import{_ as Se}from"./n96aab3r.js";import{_ as Be,a as qe}from"./o0bkrff7.js";const Fe={class:"col card-item grow",style:{position:"relative"}},Ge={class:"row label-wrapper"},He={class:"row"},Xe={class:"row label-wrapper"},ze={class:"row"},Qe={key:0,class:"col c-editor"},We={class:"row"},Je={class:"label-wrapper note-props"},Ke={class:"row center"},z=null,na=me({__name:"Note",setup(je){let $="",S;const[L]=ce(),B=m(!1),y=pe(()=>B.value||!L.value),q=m($),F=m(""),N=m(""),g=m([]),D=m(!1),ee=ve(),ae=[{type:"choice",fixed:"left",width:"32px"},{type:"index",fixed:"left",width:"100px"},{title:"分类",field:"type",width:"minmax(100px, 200px)"},{title:"名称",field:"name",width:"minmax(160px, 1fr)"},{title:"公开",field:"public",width:"46px",align:"center"},{title:"创建时间",field:"create",width:"142px",align:"center"},{title:"更新时间",field:"update",width:"142px",align:"center"},{title:"操作",field:"oper",width:"94px",align:"center",fixed:"right"}],b=fe([]),O=m(!1),h=m(""),n=m({}),E=m(!1),Q=m(z),G=_e(z),te={category:{required:!0,message:"必须选择一个分类"},name:[{required:!0,message:"必须输入笔记名称"},{max:32,message:"笔记名称长度不能超过32"}]},le=t=>{D.value||$===t||($=t,D.value=!0,K(t).then(e=>{g.value=e.data||[],D.value=!1}))},oe=async()=>{_();const t=N.value.trim();N.value="";const{data:e}=await Le(t);e&&g.value.push({id:e,name:t}),f()},ne=async()=>{_();const{data:t}=await j(q.value,F.value);Y(t)&&b.splice(0,b.length,...t),f()},ie=()=>{n.value={},E.value=!0},de=async()=>{try{await Q.value.validate()}catch{return}E.value=!1,_();const t=M({},n.value),{error:e,data:s}=await Ne(t),i="-";e?f():(b.push(M(t,{id:s,type:g.value.find(o=>o.id===t.category)?.name,create:i,update:i})),await W(t))},W=async t=>{_();try{if(!G.value){const{default:s}=await r(async()=>{const{default:a}=await import("./j76fewex.js");return{default:a}},[]),{default:i}=await r(async()=>{const{default:a}=await import("./g1lwzrok.js");return{default:a}},[]),{default:o}=await r(async()=>{const{default:a}=await import("./k5u3axtc.js");return{default:a}},[]),{default:v}=await r(async()=>{const{default:a}=await import("./jvselvnq.js").then(c=>c.a$);return{default:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{default:w}=await r(async()=>{const{default:a}=await import("./np029d02.js");return{default:a}},__vite__mapDeps([9,4])),{default:x}=await r(async()=>{const{default:a}=await import("./mobzba07.js");return{default:a}},[]),V=await r(()=>import("./jr8cclj6.js"),[]),{config:I,MdEditor:U}=await r(async()=>{const{config:a,MdEditor:c}=await import("./o0va2ham.js").then(R=>R.w);return{config:a,MdEditor:c}},__vite__mapDeps([10,1,2]));await r(()=>Promise.resolve({}),__vite__mapDeps([11])),await r(()=>Promise.resolve({}),__vite__mapDeps([12])),await r(()=>Promise.resolve({}),__vite__mapDeps([13])),await r(()=>Promise.resolve({}),__vite__mapDeps([14])),G.value=U,I({editorExtensions:{prettier:{prettierInstance:x,parserMarkdownInstance:V},highlight:{instance:w},screenfull:{instance:s},katex:{instance:i},cropper:{instance:o},mermaid:{instance:v}},codeMirrorExtensions(a){const R=A=>A.slice(0,100);return a.map(A=>A.type==="linkShortener"?{...A,options:{maxLength:100,shortenText:R}}:A)}})}n.value={...t},S=t,h.value="",O.value=!0;const{data:e}=await he(t.id);h.value=e||""}catch{Z("Markdown组件加载失败，请刷新重试！")}f()},se=async(t,e)=>{if(t.some(o=>o.size>4194306))return Z("图片大小不得超过4MB！");_();const i=n.value.id;for(const o of t){const{error:v,data:w}=await Ie(i,o);if(v)break;e([`https://scmq-dev-ed.my.site.com/services/apexrest/note/image?id=${i}&pid=${w}`])}f()},ue=async()=>{_();let t=n.value,{id:e,category:s,name:i,public:o}=n.value,{category:v,name:w,public:x}=S,V=[s,i=i?.trim(),o],I=[v,w,x];if(V.some((a,c)=>a!==I[c])){const{error:a}=await Re({id:e,category:s,name:i,isPublic:o});if(a)return f();t.name=i,M(S,{category:s,name:i,public:o})}await Ae(e,h.value.trim()),f()},re=async(t,e)=>{if(L.value){_();const{error:s}=await Pe(t.id);!s&&b.splice(e,1),f()}};return ye(L,async t=>{_(),B.value=!0;let e=t?await K():z,{data:s}=await j(),i=n.value;g.value=e?e.data:[],Y(s)&&b.splice(0,b.length,...s),O.value&&M(i,s.find(o=>o.id===o.id)),B.value=!1,f()},{immediate:!0}),(t,e)=>{const s=$e,i=we,o=Ve,v=Me,w=Te,x=Ue,V=Oe,I=De,U=Ee;return p(),P("div",Fe,[l(Se,{"min-width":600,"media-width":k(ee)},{default:d(()=>[u("div",Ge,[e[14]||(e[14]=u("span",{class:"label"},"分类",-1)),l(v,{remote:"",filterable:"",placeholder:"全部",modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=a=>q.value=a),"remote-method":le,loading:D.value,disabled:y.value},{footer:d(()=>[u("div",He,[l(i,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),style:{flex:"1"}},null,8,["modelValue"]),l(o,{type:"primary",disabled:!N.value,onClick:oe},{default:d(()=>e[13]||(e[13]=[C("添加")])),_:1},8,["disabled"])])]),default:d(()=>[l(s,{label:"全部",value:""}),(p(!0),P(H,null,X(g.value,a=>(p(),T(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),u("div",Xe,[e[15]||(e[15]=u("span",{class:"label"},"名称",-1)),l(i,{placeholder:"请输入名称",modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=a=>F.value=a),disabled:y.value},null,8,["modelValue","disabled"])]),l(o,{type:"primary",onClick:ne},{default:d(()=>e[16]||(e[16]=[C("检索")])),_:1})]),_:1},8,["media-width"]),l(Be,{columns:ae,data:b,"cell-height":48},ge({public:d(({row:a})=>[l(qe,{disabled:"",modelValue:a.public,"onUpdate:modelValue":c=>a.public=c},null,8,["modelValue","onUpdate:modelValue"])]),oper:d(({row:a,idx:c})=>[u("div",ze,[l(o,{type:"primary",circle:"",icon:k(ke),onClick:R=>W(a)},null,8,["icon","onClick"]),l(w,{width:"256",title:"确定删除吗，删除后将无法恢复？",onConfirm:R=>re(a,c)},{reference:d(()=>[l(o,{type:"danger",circle:"",icon:k(Ce),disabled:y.value||a.disabled},null,8,["icon","disabled"])]),_:2},1032,["onConfirm"])])]),_:2},[k(L)?{name:"h-oper",fn:d(()=>[l(o,{type:"success",circle:"",icon:k(xe),onClick:ie},null,8,["icon"])]),key:"0"}:void 0]),1032,["data"]),O.value?(p(),P("div",Qe,[u("div",We,[l(o,{round:"",type:"success",onClick:e[3]||(e[3]=a=>O.value=!1)},{default:d(()=>e[17]||(e[17]=[C("返回")])),_:1}),l(o,{round:"",type:"primary",disabled:y.value||n.value.disabled,onClick:ue},{default:d(()=>e[18]||(e[18]=[C("保存")])),_:1},8,["disabled"]),u("div",Je,[e[19]||(e[19]=u("div",{class:"label"},"分类",-1)),l(v,{modelValue:n.value.category,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.category=a),disabled:y.value||n.value.disabled},{default:d(()=>[(p(!0),P(H,null,X(g.value,a=>(p(),T(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e[20]||(e[20]=u("div",{class:"label"},"名称",-1)),l(i,{placeholder:"请输入笔记名称",modelValue:n.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.name=a),disabled:y.value||n.value.disabled},null,8,["modelValue","disabled"]),e[21]||(e[21]=u("div",{class:"label"},"公开",-1)),l(x,{modelValue:n.value.public,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.public=a),disabled:y.value||n.value.disabled},null,8,["modelValue","disabled"])])]),(p(),T(be(G.value),{noEcharts:"",modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),toolbarsExclude:["save","htmlPreview","github"],onOnUploadImg:se},null,40,["modelValue"]))])):J("",!0),k(L)&&E.value?(p(),T(U,{key:1,width:"460","align-center":"",title:"添加笔记",modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=a=>E.value=a)},{default:d(()=>[l(I,{"label-position":"right","label-width":"60px",ref_key:"formRef",ref:Q,model:n.value,rules:te},{default:d(()=>[l(V,{label:"分类",prop:"category"},{default:d(()=>[l(v,{modelValue:n.value.category,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.category=a)},{default:d(()=>[(p(!0),P(H,null,X(g.value,a=>(p(),T(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"名称",prop:"name"},{default:d(()=>[l(i,{modelValue:n.value.name,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"公开",prop:"public"},{default:d(()=>[l(x,{modelValue:n.value.public,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.public=a)},null,8,["modelValue"])]),_:1}),u("div",Ke,[l(o,{type:"primary",onClick:de},{default:d(()=>e[22]||(e[22]=[C("添加")])),_:1}),l(o,{type:"primary",onClick:e[11]||(e[11]=a=>E.value=!1)},{default:d(()=>e[23]||(e[23]=[C("取消")])),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"])):J("",!0)])}}});export{na as default};
