import{d as he,r as g,n as L,p as Re,ct as He,cu as Te,cv as Se,c as x,a as j,f as fe,Y as se,au as Y,o as v,X as le,m as We,v as we,w as _e,cw as Le,b as $e,e as Ve,F as ee,g as re,y as ve,h as ge,t as pe}from"./ev20qhq0.js";const Ne={class:"c-scrollbar"},de="end-reached",me="resize",ye="scroll",k=null,Ke=he({__name:"CScrollbar",props:{fillWidth:{},fillHeight:{}},emits:[de,me,ye],setup(p,{emit:U}){let C,R,T,H;const{max:B}=Math,Z=setTimeout,r=p,F=U,f=g(k),A=g(k),$=g(k),D=g(k),O=g(k),z=g(k),m=g({sw:0,w:0,l:0,x:!1,sh:0,h:0,t:0,y:!1}),oe=L(()=>{const{sw:s,w:a,l:n,x:i}=m.value,d=i?B(a/s*100,20):0;return i?{width:`${d}%`,left:`${n/(s-a)*(100-d)}%`}:{}}),V=L(()=>{const{sh:s,h:a,t:n,y:i}=m.value,d=i?B(a/s*100,20):0;return i?{height:`${d}%`,top:`${n/(s-a)*(100-d)}%`}:{}}),I=L(()=>{let{fillWidth:s,fillHeight:a}=r;return{width:s?q(s)?`${s}px`:s:k,height:a?q(a)?`${a}px`:a:k}}),q=s=>typeof s=="number",G=()=>{const{scrollWidth:s,clientWidth:a,scrollLeft:n,scrollHeight:i,clientHeight:d,scrollTop:b}=f.value;m.value={sw:s,w:a,l:n,x:s>a,sh:i,h:d,t:b,y:i>d}},S=s=>{s.stopPropagation()},y=s=>{G(),F(ye,s)},W=s=>{if(s.deltaY<=0)return;const{clientHeight:a,scrollHeight:n,scrollTop:i}=f.value;i>=n-a-1&&(C&&clearTimeout(C),C=Z(()=>{C=k,F(de,de)},500))},J=s=>{const a=f.value,n=s.currentTarget;if(n===O.value){const i=$.value.offsetHeight,d=s.offsetY-i/2,b=n.offsetHeight-i,w=a.scrollHeight-a.offsetHeight;a.scrollTop=d/b*w}if(n===z.value){const i=D.value.offsetWidth,d=s.offsetX-i/2,b=n.offsetWidth-i,w=a.scrollWidth-a.offsetWidth;a.scrollLeft=d/b*w}},Q=s=>{s.stopImmediatePropagation();let a=!0;const n=document,i="onselectstart",d="mousemove",b="mouseup",w="EventListener",t=`add${w}`,l=`remove${w}`,e=n[i],o=f.value,{clientX:c,clientY:E,currentTarget:h}=s,{scrollLeft:u,scrollTop:_}=o,N=M=>{if(a)if(h===$.value){const K=M.clientY-E,ae=O.value.offsetHeight,ce=h.offsetHeight,ie=K/(ae-ce),ne=o.scrollHeight-o.clientHeight;o.scrollTop=_+ie*ne}else{const K=M.clientX-c,ae=z.value.offsetWidth,ce=h.offsetWidth,ie=K/(ae-ce),ne=o.scrollWidth-o.clientWidth;o.scrollLeft=u+ie*ne}},X=()=>{a=!1,n[i]=e,n[l](d,N),n[l](b,X)};n[i]=()=>!1,n[t](d,N),n[t](b,X)};return Re(()=>{R=new ResizeObserver(()=>{G(),F(me,f.value)}),R.observe(f.value),R.observe(A.value)}),He(()=>{T=m.value.l,H=m.value.t}),Te(()=>(T>0||H>0)&&Z(()=>{f.value.scrollTop=H,f.value.scrollLeft=T,T=H=k})),Se(()=>{R.disconnect(),R=k}),(s,a)=>(v(),x("div",Ne,[j("div",{class:"scroll-wrapper",ref_key:"scrollWrapperRef",ref:f,onScroll:y,onTouchend:W,onWheel:W},[j("div",{class:"scroll-fill",ref_key:"scrollViewRef",ref:A,style:Y(I.value)},[se(s.$slots,"default")],4),se(s.$slots,"extra")],544),m.value.x?(v(),x("div",{key:0,class:"c-track x",ref_key:"trackXRef",ref:z,onClick:J},[j("div",{ref_key:"thumbXRef",ref:D,class:"c-thumb",style:Y(oe.value),onMousedown:Q,onClick:S},null,36)],512)):fe("",!0),m.value.y?(v(),x("div",{key:1,class:"c-track y",ref_key:"trackYRef",ref:O,onClick:J},[j("div",{ref_key:"thumbYRef",ref:$,class:"c-thumb",style:Y(V.value),onMousedown:Q,onClick:S},null,36)],512)):fe("",!0)]))}}),ke="update:modelValue",xe=he({__name:"CCheckbox",props:{modelValue:Boolean,indeterminate:Boolean,disabled:Boolean},emits:[ke],setup(p,{emit:U}){const C=p,R=U,T=H=>{H.stopPropagation(),!C.disabled&&R(ke,!C.modelValue)};return(H,B)=>(v(),x("span",{class:le(["c-checkbox",{checked:p.modelValue,none:p.indeterminate,disabled:p.disabled}]),onClick:T},null,2))}}),Ye=["data-row"],Fe="end-reached",be="row-click",Ee="row-click",te="left",Ce="center",P="right",ue=null,De=he({__name:"CTable",props:{cellHeight:{type:Number,default:36},selectKey:{type:String,default:"_check_"},columns:{type:Array,required:!0},data:{type:Array,required:!0}},emits:[Fe,be,Ee],setup(p,{emit:U}){const C=parseInt,R=parseFloat,{ceil:T,floor:H,max:B,round:Z}=Math,r=p,F=U,f=g(0),A=We([]),$=g(-1),D=g([]),O=L(()=>(r.data.length+1)*r.cellHeight),z=L(()=>D.value.reduce((t,l)=>t+l,0)),m=L(()=>{let t="m",l=D.value,{data:e,columns:o}=r,c,E,h=o.map(u=>({...u,isChoice:E=u.type==="choice",title:(c=u.type==="index")?u.title||e.length:u.title,get:E?void 0:c?J:Q})).sort((u,_)=>(u.fixed||t).localeCompare(_.fixed||t));return h.forEach((u,_,N)=>{!u.fixed&&(N=h[_-1])?.fixed&&(N.isFixedLast=!0),!u.fixed&&(N=h[_+1])?.fixed&&(N.isFixedFirst=!0),u.fixed===te&&(u.pos={left:`${l.reduce((X,M,K)=>X+(K<_?M:0),0)}px`}),u.fixed===P&&(u.pos={right:`${l.reduce((X,M,K)=>X+(K>_?M:0),0)}px`})}),h}),oe=L(()=>({gridTemplateColumns:m.value.map(t=>t.width||"1fr").join(" ")})),V=L(()=>{let{data:t,selectKey:l}=r,e=t.reduce((c,E)=>c+(E[l]?1:0),0),o=t.length;return{checked:o===e,disabled:o<1,none:e>0&&e<o}}),I=g(ue),q=g(!0),G=g(!0);let S=0,y,W;const J=(t,l)=>(l=++l+f.value)<10?`0${l}`:l,Q=(t,l,e)=>t[e.field],s=()=>{let t=r.data,l=t.length,{scrollLeft:e=0,scrollTop:o=0,scrollWidth:c=0,clientWidth:E=0}=y||{},h=l<=S?0:T(o/r.cellHeight);q.value=e<1,G.value=Z(e)>=c-E,A.splice(0,A.length,...t.slice(h,h+S)),f.value=h},a=t=>{let{data:l,selectKey:e}=r,o,c;if(l.length){o=typeof t=="boolean"?t:!V.value.checked;for(c of l)c[e]=o}},n=t=>{let l=t.key.toUpperCase();l=="PAGEUP"&&(y.scrollTop-=r.cellHeight*S),l=="PAGEDOWN"&&(y.scrollTop+=r.cellHeight*S),l=="ARROWUP"&&(y.scrollTop-=r.cellHeight),l=="ARROWDOWN"&&(y.scrollTop+=r.cellHeight),l=="HOME"&&y.scrollTo(0,0),l=="END"&&y.scrollTo(0,O.value),l=="A"&&t.ctrlKey&&r.columns.some(e=>e.type==="choice")&&a(!V.value.checked)},i=t=>{let{target:l,currentTarget:e}=t,o=l===e?ue:l.closest(".cell")?.dataset.row;return o?C(o):-1},d=t=>{let l=t.detail,e=i(t);e>=0&&l<=2&&F(l<2?be:Ee,r.data,e+f.value)},b=t=>$.value=i(t),w=t=>{y=t,S=B(H(t.clientHeight/r.cellHeight)-1,0),s()};return Re(()=>{W=new ResizeObserver(()=>{D.value=getComputedStyle(I.value).gridTemplateColumns.split(" ").map(t=>R(t)||0)}),W.observe(I.value)}),we(()=>{W&&W.disconnect(),y=W=ue}),_e(Le(r.data)?r.data:()=>r.data,s),(t,l)=>(v(),x("div",{class:le(["c-table",{[te]:q.value,[P]:G.value}]),tabindex:"0",onKeydown:n,style:Y({"--cell-height":`${p.cellHeight}px`})},[$e(Ke,{class:"table-inner","fill-width":z.value,"fill-height":O.value,onResize:w,onScroll:s,onEndReached:F},{extra:Ve(()=>[j("div",{class:"grid",ref_key:"gridRef",ref:I,style:Y(oe.value),onClick:d,onPointermove:b,onPointerleave:l[0]||(l[0]=e=>$.value=-1)},[(v(!0),x(ee,null,re(m.value,(e,o)=>(v(),x("div",{class:le(["cell th",{flex:e.flex,right:(e.thAlign||e.align)===P,center:(e.thAlign||e.align)===Ce,"fix-left":e.fixed===te,"fix-right":e.fixed===P,end:e.isFixedLast,start:e.isFixedFirst}]),key:o,style:Y(e.pos)},[e.isChoice?(v(),ve(xe,{key:0,"model-value":V.value.checked,disabled:V.value.disabled,indeterminate:V.value.none,onClick:a},null,8,["model-value","disabled","indeterminate"])):se(t.$slots,`h-${e.field}`,{key:1},()=>[ge(pe(e.title),1)])],6))),128)),(v(!0),x(ee,null,re(A,(e,o)=>(v(),x(ee,{key:o},[(v(!0),x(ee,null,re(m.value,(c,E)=>(v(),x("div",{class:le(["cell",{flex:c.flex,right:(c.align||c.thAlign)===P,center:(c.align||c.thAlign)===Ce,selected:e[p.selectKey],hover:$.value===o,odd:(o&1)<1,"fix-left":c.fixed===te,"fix-right":c.fixed===P,end:c.isFixedLast,start:c.isFixedFirst}]),key:`${o}-${E}`,"data-row":o,style:Y(c.pos)},[c.isChoice?(v(),ve(xe,{key:0,modelValue:e[p.selectKey],"onUpdate:modelValue":h=>e[p.selectKey]=h},null,8,["modelValue","onUpdate:modelValue"])):se(t.$slots,c.field,{key:1,row:e,idx:o},()=>[ge(pe(c.get(e,o,c)),1)])],14,Ye))),128))],64))),128))],36)]),_:3},8,["fill-width","fill-height"])],38))}});export{De as _,xe as a};
