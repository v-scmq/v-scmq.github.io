import{d as ge,r as D,n as b,p as N,s as ve,v as _e,x as we,y as ke,c as T,a as be,z as L,m as r,f as o,b as c,F as B,e as p,A as V,i as ae,B as Te,l as le,C as Ee,D as ne,G as Se,E as xe,H as Ce,o as l,h as g,t as E,I as y,J as R,K as Ie}from"./i-k271y7tk.js";import{E as Ae}from"./i-klhk99nn.js";import{E as Re}from"./i-djcsjtq1.js";import{E as Pe,a as De}from"./i-bjye9jzf.js";const Me={class:"col card-item grow",style:{position:"relative"}},ze={class:"row"},Ue={key:0,class:"row"},Fe={key:1,class:"row"},Ne={key:1,class:"row"},Le={key:2,class:"row"},Be=0,se=1,q=2,M=3,oe=4,re="您的浏览器不支持文件系统API",je=ge({__name:"File",setup(Ve){const{showDirectoryPicker:O,showOpenFilePicker:G}=window,W=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],j={0:"准备中",1:"已暂停",2:"已失败",3:"等待中",4:"传输中"},S=["文件管理","上传列表","下载列表"],x=D(S[0]),U=b(()=>x.value===S[0]),P=b(()=>x.value===S[1]),H=b(()=>x.value===S[2]),w=N([]),u=N([]),d=N([]),J=D(),K=D(),Y=D(),f=D([]),m=ve();let C=0,h=new Worker(new URL(""+new URL("i-bm89iaqe.js",import.meta.url).href,import.meta.url),{type:"module"});const F=e=>{f.value=e},$=b(()=>{let e=f.value;return e=e.length?e:P.value?u:d,e.findIndex(t=>t.state<M)>=0}),Q=b(()=>{let e=f.value;return e=e.length?e:P.value?u:d,e.findIndex(t=>t.state>q)>=0}),k=b(()=>f.value.length),z=b(()=>U.value?w.length<1:P.value?u.length<1:d.length<1),I=b(()=>k.value?"":"全部"),v=()=>{var e,t,a;(e=J.value)==null||e.clearSelection(),(t=K.value)==null||t.clearSelection(),(a=Y.value)==null||a.clearSelection()},ie=async()=>{if(!G)return R(re);try{const e=await G({multiple:!0});h.postMessage({k:"b",v:e}),v(),x.value=S[1]}catch{}},de=async()=>{let e=(k.value?f.value:u).filter(a=>a.state<M);if((await Promise.all(e.map(a=>a.handle.requestPermission()))).find(a=>a!=="granted"))return R("必须授予文件读取权限，才能够继续！");v(),e.forEach(a=>a.state=M),h.postMessage({k:"c",v:e.map(a=>({...a}))})},X=async()=>{let e=(k.value?f.value:u).filter(t=>t.state>q);v(),e.forEach(t=>t.state=se),h.postMessage({k:"c",v:e.map(t=>({...t}))})},ce=async()=>{let e=f.value.map(a=>a.id),t=new Set(e);v();for(let a=u.length-1;a>=0;--a)t.has(u[a].id)&&u.splice(a,1);h.postMessage({k:"d",v:e})},ue=async()=>{let e=f.value,t=new Set(d.map(i=>i.id)),a=e.filter(i=>t.has(i.id)).map(i=>i.name),n=e.filter(i=>!t.has(i.id)).map(i=>({id:i.id,name:i.name,part:0,size:i.size,state:Be,rate:0,_type:i._type,_size:i._size}));if(a.length&&R(`${a.join(";")}已经在下载任务列表，不可重复操作！`),n.length<1)return;let s,A="readwrite";if(C===0){if(!O)return R(re);if(s=await O({mode:A,startIn:"downloads"}).catch(()=>{}),!s)return R("必须选择一个下载目录！");C=1}else if(C!==1){if(await(s=C).requestPermission({mode:A})!=="granted")return R("必须授予下载目录读写权限，才能够继续！");C=1}d.push(...n),h.postMessage({k:"e",v:{l:n,d:s}}),v(),x.value=S[2]},pe=async()=>{let e=(k.value?f.value:d).filter(t=>t.state<M);v(),e.forEach(t=>t.state=M),h.postMessage({k:"f",v:e.map(t=>({...t}))})},Z=async()=>{let e=(k.value?f.value:d).filter(t=>t.state>q);v(),e.forEach(t=>t.state=se),h.postMessage({k:"f",v:e.map(t=>({...t}))})},me=async()=>{let e=f.value.map(a=>a.id),t=new Set(e);v();for(let a=d.length-1;a>=0;--a)t.has(d[a].id)&&d.splice(a,1);h.postMessage({k:"g",v:e})},he=()=>{Ie("注意删除后不能恢复，确定删除？","确认删除？").then(()=>{ae();let e=f.value.map(a=>a.id),t=new Set(e);v(),ne(e).then(({data:a})=>{for(let n=a?w.length-1:-1;n>=0;--n)t.has(w[n].id)&&w.splice(n,1);le()})})},ee=()=>{ae(),Te().then(e=>{w.splice(0,w.length,...e.data||[]),le()})},te=(e,t)=>{let a=(t?d:u).find(n=>n.id===e.id);a&&Ce(a,e)},ye={a([e,t,[a]]){u.push(...e),d.push(...t),a&&(C=a.val)},b(e){u.push(...e)},c(e){te(e,0)},d(e){if(Ee(e))return ne(e);let t=u.findIndex(a=>a.id===e);if(t>-1){let a=u.splice(t,1)[0],n="***";w.push({id:a.rid,part:a.part,path:a.path,name:a.name,type:a.type,size:a.size,create:n,update:n,_type:a._type,_size:a._size})}},f(e){te(e,1)},g(e){let t=d.findIndex(a=>a.id===e);t>-1&&d.splice(t,1)}};return _e(()=>{h.onmessage=({data:e})=>{ye[e.k](e.v)},h.postMessage({k:"a",v:we()}),ee()}),ke(()=>{X(),Z(),h==null||h.terminate()}),(e,t)=>{const a=Se,n=xe,s=De,A=Pe,i=Re,fe=Ae;return l(),T("div",Me,[be("div",ze,[c(a,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=_=>x.value=_),options:S,onChange:v,style:{"margin-right":"auto"}},null,8,["modelValue"]),U.value?(l(),T(B,{key:0},[k.value?(l(),T("div",Ue,[c(n,{round:"",type:"primary",onClick:ue},{default:p(()=>t[1]||(t[1]=[g("下载")])),_:1}),c(n,{round:"",type:"danger",onClick:he},{default:p(()=>t[2]||(t[2]=[g("删除")])),_:1})])):(l(),T("div",Fe,[c(n,{round:"",type:"primary",onClick:ee},{default:p(()=>t[3]||(t[3]=[g("刷新")])),_:1}),c(n,{round:"",type:"primary",onClick:ie},{default:p(()=>t[4]||(t[4]=[g("上传")])),_:1})]))],64)):o("",!0),P.value&&u.length?(l(),T("div",Ne,[$.value?(l(),r(n,{key:0,round:"",type:"primary",onClick:de},{default:p(()=>[g(E(I.value)+"开始",1)]),_:1})):o("",!0),Q.value?(l(),r(n,{key:1,round:"",type:"primary",onClick:X},{default:p(()=>[g(E(I.value)+"暂停",1)]),_:1})):o("",!0),k.value?(l(),r(n,{key:2,round:"",type:"danger",onClick:ce},{default:p(()=>[g(E(I.value)+"取消",1)]),_:1})):o("",!0)])):o("",!0),H.value&&d.length?(l(),T("div",Le,[$.value?(l(),r(n,{key:0,round:"",type:"primary",onClick:pe},{default:p(()=>[g(E(I.value)+"开始",1)]),_:1})):o("",!0),Q.value?(l(),r(n,{key:1,round:"",type:"primary",onClick:Z},{default:p(()=>[g(E(I.value)+"暂停",1)]),_:1})):o("",!0),k.value?(l(),r(n,{key:2,round:"",type:"danger",onClick:me},{default:p(()=>[g(E(I.value)+"取消",1)]),_:1})):o("",!0)])):o("",!0)]),L(c(A,{height:"100%",border:"",style:{flex:"1",width:"100%"},"empty-text":"无任何文件",ref_key:"fileTableRef",ref:J,data:w,onSelectionChange:F},{default:p(()=>[c(s,{type:"selection",width:"40"}),y(m)>599?(l(),r(s,{key:0,type:"index",label:"序号",width:"60",align:"center"})):o("",!0),c(s,{prop:"name",label:"名称","class-name":"cell--nowrap"}),y(m)>599?(l(),r(s,{key:1,prop:"_size",label:"大小",width:"94",align:"right","header-align":"center"})):o("",!0),y(m)>639?(l(),r(s,{key:2,prop:"_type",label:"类型",width:"60",align:"center"})):o("",!0),y(m)>899?(l(),r(s,{key:3,prop:"create",label:"创建时间",width:"144",align:"center"})):o("",!0),y(m)>899?(l(),r(s,{key:4,prop:"update",label:"更新时间",width:"144",align:"center"})):o("",!0)]),_:1},8,["data"]),[[V,U.value&&!z.value]]),L(c(A,{height:"100%",border:"",style:{flex:"1",width:"100%"},ref_key:"uploadTableRef",ref:K,data:u,onSelectionChange:F},{default:p(()=>[c(s,{type:"selection",width:"40",align:"center"}),y(m)>599?(l(),r(s,{key:0,type:"index",label:"序号",width:"80",align:"center"})):o("",!0),c(s,{prop:"name",label:"名称","class-name":"cell--nowrap"}),c(s,{label:"进度",align:"center",width:y(m)>799?220:160},{default:p(({row:_})=>[_.state===oe?(l(),r(i,{key:0,"text-inside":!0,"stroke-width":26,percentage:_.rate,color:W},null,8,["percentage"])):(l(),T(B,{key:1},[g(E(j[_.state]),1)],64))]),_:1},8,["width"]),y(m)>799?(l(),r(s,{key:1,prop:"_type",label:"类型",width:"60",align:"center","class-name":"cell--nowrap"})):o("",!0),y(m)>599?(l(),r(s,{key:2,prop:"_size",label:"大小",width:"94",align:"right","header-align":"center","class-name":"cell--nowrap"})):o("",!0)]),_:1},8,["data"]),[[V,P.value&&!z.value]]),L(c(A,{height:"100%",border:"",style:{flex:"1",width:"100%"},ref_key:"downloadTableRef",ref:Y,data:d,onSelectionChange:F},{default:p(()=>[c(s,{type:"selection",width:"40",align:"center"}),y(m)>599?(l(),r(s,{key:0,type:"index",label:"序号",width:"80",align:"center"})):o("",!0),c(s,{prop:"name",label:"名称","class-name":"cell--nowrap"}),c(s,{label:"进度",align:"center",width:y(m)>799?220:160},{default:p(({row:_})=>[_.state===oe?(l(),r(i,{key:0,"text-inside":!0,"stroke-width":26,percentage:_.rate,color:W},null,8,["percentage"])):(l(),T(B,{key:1},[g(E(j[_.state]),1)],64))]),_:1},8,["width"]),y(m)>799?(l(),r(s,{key:1,prop:"_type",label:"类型",width:"60",align:"center","class-name":"cell--nowrap"})):o("",!0),y(m)>599?(l(),r(s,{key:2,prop:"_size",label:"大小",width:"90",align:"right","header-align":"center","class-name":"cell--nowrap"})):o("",!0)]),_:1},8,["data"]),[[V,H.value&&!z.value]]),z.value?(l(),r(fe,{key:0})):o("",!0)])}}});export{je as default};
