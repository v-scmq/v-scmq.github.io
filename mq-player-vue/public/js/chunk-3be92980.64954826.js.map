{"version":3,"sources":["webpack:///./src/renderer/views/MVList.vue?8d93","webpack:///./src/renderer/views/MVList.vue?d17e","webpack:///./src/renderer/views/MVList.vue?6fdb","webpack:///./src/renderer/views/MVList.vue"],"names":["_hoisted_1","_hoisted_2","_hoisted_3","_createTextVNode","render","_ctx","_cache","$props","$setup","$data","$options","_component_image_view","_resolveComponent","_component_grid_view","_openBlock","_createElementBlock","_Fragment","_renderList","tags","children","index","class","key","onClick","args","onListViewClicked","tag","_normalizeClass","active","id","mvTagParam","group","value","_toDisplayString","name","_createVNode","style","data","mvList","onInfiniteScroll","loadData","default","_withCtx","item","modelValue","cover","$event","defaultValue","_createElementVNode","singer","mid","title","_","defineComponent","setup","reactive","page","current","size","onMounted","Spinner","open","getMvList","then","Object","assign","tagList","keys","forEach","property","push","splice","length","list","finally","close","event","target","getAttribute","split","pageCount","catch","__exports__"],"mappings":"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","file":"public/js/chunk-3be92980.64954826.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./MVList.vue?vue&type=style&index=0&id=0d841a12&scoped=true&lang=css\"","import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-0d841a12\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = [\"data-tag\"]\nconst _hoisted_2 = [\"data-mid\"]\nconst _hoisted_3 = /*#__PURE__*/_createTextVNode(\" -\")\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_image_view = _resolveComponent(\"image-view\")!\n  const _component_grid_view = _resolveComponent(\"grid-view\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.tags, (children, index) => {\n      return (_openBlock(), _createElementBlock(\"div\", {\n        class: \"v-row list-view\",\n        key: index,\n        onClick: _cache[0] || (_cache[0] = \n//@ts-ignore\n(...args) => (_ctx.onListViewClicked && _ctx.onListViewClicked(...args)))\n      }, [\n        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(children, (tag) => {\n          return (_openBlock(), _createElementBlock(\"div\", {\n            class: _normalizeClass([\"item\", {active: tag.id === _ctx.mvTagParam[tag.group]}]),\n            key: tag.id,\n            \"data-tag\": tag.value\n          }, _toDisplayString(tag.name), 11, _hoisted_1))\n        }), 128))\n      ]))\n    }), 128)),\n    _createVNode(_component_grid_view, {\n      class: \"arc-rect\",\n      style: {\"margin-top\":\"1em\"},\n      \"cell-widths\": \"repeat(auto-fit, 16em)\",\n      data: _ctx.mvList,\n      \"cell-height\": 206,\n      onInfiniteScroll: _ctx.loadData\n    }, {\n      default: _withCtx(({item}) => [\n        _createVNode(_component_image_view, {\n          modelValue: item.cover,\n          \"onUpdate:modelValue\": ($event: any) => ((item.cover) = $event),\n          defaultValue: \"/icon/mv.png\"\n        }, null, 8, [\"modelValue\", \"onUpdate:modelValue\"]),\n        _createElementVNode(\"div\", null, [\n          (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(item.singer, (singer, index) => {\n            return (_openBlock(), _createElementBlock(\"span\", {\n              class: \"link\",\n              key: index,\n              \"data-mid\": singer.mid\n            }, _toDisplayString(singer.name), 9, _hoisted_2))\n          }), 128)),\n          _hoisted_3,\n          _createElementVNode(\"span\", null, _toDisplayString(item.title), 1)\n        ])\n      ]),\n      _: 1\n    }, 8, [\"data\", \"onInfiniteScroll\"])\n  ], 64))\n}","\r\nimport {getMvList} from '../api';\r\nimport Spinner from '../components/Spinner';\r\n\r\nimport {reactive, onMounted, defineComponent} from 'vue';\r\nimport {ComputedPage, Mv, MvTagsParam} from 'src/types';\r\n\r\n/**\r\n * tag标签节点信息\r\n */\r\ntype TagItemNode = {\r\n  /** 分类标签名称  */\r\n  name: string;\r\n  /** 分类标签id  */\r\n  id: string | number;\r\n  /** 所属分类组  */\r\n  group: string;\r\n  /** `${分类标签分类组}-${分类标签id}`  */\r\n  value: string;\r\n};\r\n\r\nexport default defineComponent({\r\n  name: 'MVList',\r\n\r\n  setup() {\r\n    const tags = reactive<TagItemNode[][]>([]);\r\n    const mvList = reactive<Mv[]>([]);\r\n    const mvTagParam = reactive<MvTagsParam>({} as MvTagsParam);\r\n    const page = {current: 1, size: 30} as ComputedPage;\r\n\r\n    onMounted(() => {\r\n      Spinner.open();\r\n\r\n      getMvList(page, null).then(data => {\r\n        // 获取 total(总数据条数) 和 size(每页数据量,有可能会被重设为其他值)\r\n        data.page && Object.assign(page, data.page);\r\n\r\n        const tagList: TagItemNode[][] = [];\r\n\r\n        // 转换结构 => {a:[{id, name}], b:[{id, name}]} => [[{id, name, group:a, value:'a;${id}'}] , ...]\r\n        Object.keys(data.tags).forEach(key => {\r\n          const property = key as keyof typeof mvTagParam;\r\n          const children = data.tags[property];\r\n          //  {a:[{id:1,name:'A'}], b:[{}] } => {a:id, b:id}\r\n          mvTagParam[property] = (children[0] && children[0].id) as string; // 1 && 0 => 0\r\n\r\n          // {id, name} => {id, name, group:key, value:`${key};${id}`}\r\n          children.forEach(item => item.value = `${item.group = key};${item.id}`);\r\n\r\n          tagList.push(children as TagItemNode[]);\r\n        });\r\n\r\n        // 添加Mv分类标签信息\r\n        tags.splice(0, tags.length, ...tagList);\r\n\r\n        // 添加Mv数据\r\n        mvList.splice(0, mvList.length, ...data.list);\r\n\r\n      }).finally(Spinner.close);\r\n    });\r\n\r\n    return {\r\n      tags, mvList, mvTagParam,\r\n\r\n      /**\r\n       * Mv分类标签被点击时, 加载最新的Mv数据列表\r\n       *\r\n       * @param event 点击事件\r\n       */\r\n      onListViewClicked(event: PointerEvent) {\r\n        const value = (event.target as HTMLElement).getAttribute('data-tag');\r\n        if (!value) {\r\n          return;\r\n        }\r\n\r\n        // 获取分类标签所属组 和 分类标签id\r\n        const [group, id] = value.split(';');\r\n\r\n        // @ts-ignore 若未改变, 则什么也不做\r\n        if (mvTagParam[group] === id) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore 设定当前分类组对应的分类标签id\r\n        mvTagParam[group] = id;\r\n        // 重设为第一页\r\n        page.current = 1;\r\n\r\n        Spinner.open();\r\n\r\n        getMvList(page, mvTagParam).then(data => {\r\n          Object.assign(page, data.page);\r\n\r\n          mvList.splice(0, mvList.length, ...data.list);\r\n\r\n        }).finally(Spinner.close);\r\n      },\r\n\r\n      /** 加载数据到视图上(无限滚动触发点) */\r\n      loadData() {\r\n        // 若还有数据, 则发起网络请求加载歌曲数据列表\r\n        if (page.current >= 1 && page.current < page.pageCount) {\r\n          Spinner.open();\r\n\r\n          ++page.current;\r\n\r\n          getMvList(page, mvTagParam).then(data => {\r\n            Object.assign(page, data.page);\r\n\r\n            mvList.push(...data.list);\r\n\r\n          }).catch(() => --page.current).finally(Spinner.close);\r\n        }\r\n      }\r\n\r\n    };\r\n  }\r\n\r\n});\r\n","import { render } from \"./MVList.vue?vue&type=template&id=0d841a12&scoped=true&ts=true\"\nimport script from \"./MVList.vue?vue&type=script&lang=ts\"\nexport * from \"./MVList.vue?vue&type=script&lang=ts\"\n\nimport \"./MVList.vue?vue&type=style&index=0&id=0d841a12&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\SCMQ\\\\project\\\\HTML\\\\mq-player-vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-0d841a12\"]])\n\nexport default __exports__"],"sourceRoot":""}