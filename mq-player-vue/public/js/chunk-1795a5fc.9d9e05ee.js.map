{"version":3,"sources":["webpack:///./src/renderer/views/SingerList.vue?02b5","webpack:///./src/renderer/views/SingerList.vue?c0f2","webpack:///./src/renderer/views/SingerList.vue","webpack:///./src/renderer/views/SingerList.vue?2cb5"],"names":["_hoisted_1","render","_ctx","_cache","$props","$setup","$data","$options","_component_image_view","_component_grid_view","tags","children","index","class","key","onClick","args","onListViewClicked","tag","active","id","singerTagParam","group","value","name","style","data","singerList","onCellClick","navigateTo","onInfiniteScroll","loadData","default","item","modelValue","cover","$event","defaultValue","_","page","current","size","total","router","Spinner","open","then","Object","assign","tagList","singerTags","keys","forEach","property","push","splice","length","list","finally","close","event","target","getAttribute","split","catch","singer","path","query","pageCount","__exports__"],"mappings":"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","file":"public/js/chunk-1795a5fc.9d9e05ee.js","sourcesContent":["import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, withCtx as _withCtx, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-2e3fe2ee\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = [\"data-tag\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_image_view = _resolveComponent(\"image-view\")!\n  const _component_grid_view = _resolveComponent(\"grid-view\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.tags, (children, index) => {\n      return (_openBlock(), _createElementBlock(\"div\", {\n        class: \"v-row list-view\",\n        key: index,\n        onClick: _cache[0] || (_cache[0] = \n//@ts-ignore\n(...args) => (_ctx.onListViewClicked && _ctx.onListViewClicked(...args)))\n      }, [\n        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(children, (tag) => {\n          return (_openBlock(), _createElementBlock(\"div\", {\n            class: _normalizeClass([\"item\", {active: tag.id === _ctx.singerTagParam[tag.group]}]),\n            key: tag.id,\n            \"data-tag\": tag.value\n          }, _toDisplayString(tag.name), 11, _hoisted_1))\n        }), 128))\n      ]))\n    }), 128)),\n    _createVNode(_component_grid_view, {\n      style: {\"margin-top\":\"1em\"},\n      data: _ctx.singerList,\n      \"cell-widths\": \"repeat(auto-fit, 13em)\",\n      \"cell-height\": 234,\n      onCellClick: _ctx.navigateTo,\n      onInfiniteScroll: _ctx.loadData\n    }, {\n      default: _withCtx(({item}) => [\n        _createVNode(_component_image_view, {\n          modelValue: item.cover,\n          \"onUpdate:modelValue\": ($event: any) => ((item.cover) = $event),\n          defaultValue: \"icon/singer.png\"\n        }, null, 8, [\"modelValue\", \"onUpdate:modelValue\"]),\n        _createElementVNode(\"div\", null, _toDisplayString(item.name), 1)\n      ]),\n      _: 1\n    }, 8, [\"data\", \"onCellClick\", \"onInfiniteScroll\"])\n  ], 64))\n}","\r\nimport {getSingerList} from '../api';\r\nimport Spinner from '../components/Spinner';\r\n\r\nimport {reactive, onMounted, defineComponent} from 'vue';\r\nimport {useRouter} from 'vue-router';\r\n\r\nimport {ComputedPage, Singer, SingerTags, SingerTagsParam} from 'src/types';\r\n\r\n/**\r\n * tag标签节点信息\r\n */\r\ntype TagItemNode = {\r\n  /** 分类标签名称  */\r\n  name: string;\r\n  /** 分类标签id  */\r\n  id: string | number;\r\n  /** 所属分类组  */\r\n  group: string;\r\n  /** `${分类标签分类组}-${分类标签id}`  */\r\n  value: string;\r\n};\r\n\r\nexport default defineComponent({\r\n  name: 'SingerListView',\r\n\r\n  setup() {\r\n    const tags = reactive<TagItemNode[][]>([]);\r\n    const singerList = reactive<Singer[]>([]);\r\n    const singerTagParam = reactive<SingerTagsParam>({} as SingerTagsParam);\r\n    // 无限滚动 + 列表虚拟滚动\r\n    const page = {current: 1, size: 30, total: 0} as ComputedPage;\r\n\r\n    const router = useRouter();\r\n\r\n    onMounted(() => {\r\n      Spinner.open();\r\n\r\n      getSingerList(page, null).then(data => {\r\n        // 获取 total(总数据条数) 和 size(每页数据量,有可能会被重设为其他值)\r\n        data.page && Object.assign(page, data.page);\r\n\r\n        const tagList:TagItemNode[][] = [];\r\n        const singerTags = data.tags as SingerTags;\r\n\r\n        // 转换结构 => {a:[{id, name}], b:[{id, name}]} => [[{id, name, group:a, value:'a;${id}'}] , ...]\r\n        Object.keys(singerTags).forEach(key => {\r\n          const property = key as keyof typeof singerTags;\r\n          const children = singerTags[property];\r\n          //  {a:[{id:1,name:'A'}], b:[{}] } => {a:id, b:id}\r\n          singerTagParam[property] = (children[0] && children[0].id) as string; // 1 && 0 => 0\r\n\r\n          // {id, name} => {id, name, group:key, value:`${key};${id}`}\r\n          children.forEach(item => item.value = `${item.group = key};${item.id}`);\r\n\r\n          tagList.push(children as TagItemNode[]);\r\n        });\r\n\r\n        // 添加歌手分类标签列表数据\r\n        tags.splice(0, tags.length, ...tagList);\r\n        // 添加歌手列表数据\r\n        singerList.splice(0, singerList.length, ...data.list);\r\n\r\n      }).finally(Spinner.close);\r\n    });\r\n\r\n    return {\r\n      tags, singerList, singerTagParam,\r\n\r\n      /**\r\n       * 歌手分类标签被点击时, 加载最新的歌手数据列表\r\n       *\r\n       * @param event 点击事件\r\n       */\r\n      onListViewClicked(event: PointerEvent) {\r\n        const value = (event.target as HTMLElement).getAttribute('data-tag');\r\n        if (!value) {\r\n          return;\r\n        }\r\n\r\n        // 获取分类标签所属组 和 分类标签id\r\n        const [group, id] = value.split(';');\r\n\r\n        // @ts-ignore 若未改变, 则什么也不做\r\n        if (singerTagParam[group] === id || !group) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore 设定当前分类组对应的分类标签id\r\n        singerTagParam[group] = id;\r\n        // 重设为第一页\r\n        page.current = 1;\r\n\r\n        Spinner.open();\r\n        getSingerList(page, singerTagParam).then(data => {\r\n          // 重设分页信息\r\n          data.page && Object.assign(page, data.page);\r\n          // 添加歌手数据\r\n          singerList.splice(0, singerList.length, ...data.list);\r\n\r\n        }).catch(() => --page.current).finally(Spinner.close);\r\n      },\r\n\r\n      /**\r\n       * 跳转到歌手视图\r\n       *\r\n       * @param singer 歌手信息\r\n       */\r\n      navigateTo(singer: Singer) {\r\n        router.push({path: '/singer-view', query: singer});\r\n      },\r\n\r\n      /** 加载数据到视图上(无限滚动触发点) */\r\n      loadData() {\r\n        // 若还有数据, 则发起网络请求加载歌曲数据列表\r\n        if (page.current >= 1 && page.current < page.pageCount) {\r\n          Spinner.open();\r\n\r\n          ++page.current;\r\n\r\n          getSingerList(page, singerTagParam).then(data => {\r\n            // 重设分页信息\r\n            data.page && Object.assign(page, data.page);\r\n            // 添加歌手数据\r\n            singerList.push(...data.list);\r\n\r\n          }).catch(() => --page.current).finally(Spinner.close);\r\n        }\r\n      }\r\n\r\n    };\r\n  }\r\n\r\n});\r\n","import { render } from \"./SingerList.vue?vue&type=template&id=2e3fe2ee&scoped=true&ts=true\"\nimport script from \"./SingerList.vue?vue&type=script&lang=ts\"\nexport * from \"./SingerList.vue?vue&type=script&lang=ts\"\n\nimport \"./SingerList.vue?vue&type=style&index=0&id=2e3fe2ee&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\SCMQ\\\\Project\\\\mq-player-vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2e3fe2ee\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./SingerList.vue?vue&type=style&index=0&id=2e3fe2ee&scoped=true&lang=css\""],"sourceRoot":""}