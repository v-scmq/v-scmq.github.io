{"version":3,"sources":["webpack:///./src/renderer/views/SingerList.vue?8541","webpack:///./src/renderer/views/SingerList.vue?9116","webpack:///./src/renderer/views/SingerList.vue?c0f2","webpack:///./src/renderer/views/SingerList.vue"],"names":["_hoisted_1","render","_ctx","_cache","$props","$setup","$data","$options","_component_image_view","_resolveComponent","_component_grid_view","_openBlock","_createElementBlock","_Fragment","_renderList","tags","children","index","class","key","onClick","args","onListViewClicked","tag","_normalizeClass","active","id","singerTagParam","group","value","_toDisplayString","name","_createVNode","style","data","singerList","onCellClick","navigateTo","onInfiniteScroll","loadData","default","_withCtx","item","modelValue","cover","$event","defaultValue","_createElementVNode","_","defineComponent","setup","reactive","page","current","size","total","router","useRouter","onMounted","Spinner","open","getSingerList","then","Object","assign","tagList","singerTags","keys","forEach","property","push","splice","length","list","finally","close","event","target","getAttribute","split","catch","singer","path","query","pageCount","__exports__"],"mappings":"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","file":"public/js/chunk-3f1ff592.c8f9e762.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./SingerList.vue?vue&type=style&index=0&id=31f6da59&scoped=true&lang=css\"","import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, withCtx as _withCtx, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-31f6da59\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = [\"data-tag\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_image_view = _resolveComponent(\"image-view\")!\n  const _component_grid_view = _resolveComponent(\"grid-view\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.tags, (children, index) => {\n      return (_openBlock(), _createElementBlock(\"div\", {\n        class: \"v-row list-view\",\n        key: index,\n        onClick: _cache[0] || (_cache[0] = \n//@ts-ignore\n(...args) => (_ctx.onListViewClicked && _ctx.onListViewClicked(...args)))\n      }, [\n        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(children, (tag) => {\n          return (_openBlock(), _createElementBlock(\"div\", {\n            class: _normalizeClass([\"item\", {active: tag.id === _ctx.singerTagParam[tag.group]}]),\n            key: tag.id,\n            \"data-tag\": tag.value\n          }, _toDisplayString(tag.name), 11, _hoisted_1))\n        }), 128))\n      ]))\n    }), 128)),\n    _createVNode(_component_grid_view, {\n      style: {\"margin-top\":\"1em\"},\n      data: _ctx.singerList,\n      \"cell-widths\": \"repeat(auto-fit, 13em)\",\n      \"cell-height\": 234,\n      onCellClick: _ctx.navigateTo,\n      onInfiniteScroll: _ctx.loadData\n    }, {\n      default: _withCtx(({item}) => [\n        _createVNode(_component_image_view, {\n          modelValue: item.cover,\n          \"onUpdate:modelValue\": ($event: any) => ((item.cover) = $event),\n          defaultValue: \"/icon/singer.png\"\n        }, null, 8, [\"modelValue\", \"onUpdate:modelValue\"]),\n        _createElementVNode(\"div\", null, _toDisplayString(item.name), 1)\n      ]),\n      _: 1\n    }, 8, [\"data\", \"onCellClick\", \"onInfiniteScroll\"])\n  ], 64))\n}","\r\nimport {getSingerList} from '../api';\r\nimport Spinner from '../components/Spinner';\r\n\r\nimport {reactive, onMounted, defineComponent} from 'vue';\r\nimport {useRouter} from 'vue-router';\r\n\r\nimport {ComputedPage, Singer, SingerTags, SingerTagsParam} from 'src/types';\r\n\r\n/**\r\n * tag标签节点信息\r\n */\r\ntype TagItemNode = {\r\n  /** 分类标签名称  */\r\n  name: string;\r\n  /** 分类标签id  */\r\n  id: string | number;\r\n  /** 所属分类组  */\r\n  group: string;\r\n  /** `${分类标签分类组}-${分类标签id}`  */\r\n  value: string;\r\n};\r\n\r\nexport default defineComponent({\r\n  name: 'SingerListView',\r\n\r\n  setup() {\r\n    const tags = reactive<TagItemNode[][]>([]);\r\n    const singerList = reactive<Singer[]>([]);\r\n    const singerTagParam = reactive<SingerTagsParam>({} as SingerTagsParam);\r\n    // 无限滚动 + 列表虚拟滚动\r\n    const page = {current: 1, size: 30, total: 0} as ComputedPage;\r\n\r\n    const router = useRouter();\r\n\r\n    onMounted(() => {\r\n      Spinner.open();\r\n\r\n      getSingerList(page, null).then(data => {\r\n        // 获取 total(总数据条数) 和 size(每页数据量,有可能会被重设为其他值)\r\n        data.page && Object.assign(page, data.page);\r\n\r\n        const tagList:TagItemNode[][] = [];\r\n        const singerTags = data.tags as SingerTags;\r\n\r\n        // 转换结构 => {a:[{id, name}], b:[{id, name}]} => [[{id, name, group:a, value:'a;${id}'}] , ...]\r\n        Object.keys(singerTags).forEach(key => {\r\n          const property = key as keyof typeof singerTags;\r\n          const children = singerTags[property];\r\n          //  {a:[{id:1,name:'A'}], b:[{}] } => {a:id, b:id}\r\n          singerTagParam[property] = (children[0] && children[0].id) as string; // 1 && 0 => 0\r\n\r\n          // {id, name} => {id, name, group:key, value:`${key};${id}`}\r\n          children.forEach(item => item.value = `${item.group = key};${item.id}`);\r\n\r\n          tagList.push(children as TagItemNode[]);\r\n        });\r\n\r\n        // 添加歌手分类标签列表数据\r\n        tags.splice(0, tags.length, ...tagList);\r\n        // 添加歌手列表数据\r\n        singerList.splice(0, singerList.length, ...data.list);\r\n\r\n      }).finally(Spinner.close);\r\n    });\r\n\r\n    return {\r\n      tags, singerList, singerTagParam,\r\n\r\n      /**\r\n       * 歌手分类标签被点击时, 加载最新的歌手数据列表\r\n       *\r\n       * @param event 点击事件\r\n       */\r\n      onListViewClicked(event: PointerEvent) {\r\n        const value = (event.target as HTMLElement).getAttribute('data-tag');\r\n        if (!value) {\r\n          return;\r\n        }\r\n\r\n        // 获取分类标签所属组 和 分类标签id\r\n        const [group, id] = value.split(';');\r\n\r\n        // @ts-ignore 若未改变, 则什么也不做\r\n        if (singerTagParam[group] === id || !group) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore 设定当前分类组对应的分类标签id\r\n        singerTagParam[group] = id;\r\n        // 重设为第一页\r\n        page.current = 1;\r\n\r\n        Spinner.open();\r\n        getSingerList(page, singerTagParam).then(data => {\r\n          // 重设分页信息\r\n          data.page && Object.assign(page, data.page);\r\n          // 添加歌手数据\r\n          singerList.splice(0, singerList.length, ...data.list);\r\n\r\n        }).catch(() => --page.current).finally(Spinner.close);\r\n      },\r\n\r\n      /**\r\n       * 跳转到歌手视图\r\n       *\r\n       * @param singer 歌手信息\r\n       */\r\n      navigateTo(singer: Singer) {\r\n        router.push({path: '/singer-view', query: singer});\r\n      },\r\n\r\n      /** 加载数据到视图上(无限滚动触发点) */\r\n      loadData() {\r\n        // 若还有数据, 则发起网络请求加载歌曲数据列表\r\n        if (page.current >= 1 && page.current < page.pageCount) {\r\n          Spinner.open();\r\n\r\n          ++page.current;\r\n\r\n          getSingerList(page, singerTagParam).then(data => {\r\n            // 重设分页信息\r\n            data.page && Object.assign(page, data.page);\r\n            // 添加歌手数据\r\n            singerList.push(...data.list);\r\n\r\n          }).catch(() => --page.current).finally(Spinner.close);\r\n        }\r\n      }\r\n\r\n    };\r\n  }\r\n\r\n});\r\n","import { render } from \"./SingerList.vue?vue&type=template&id=31f6da59&scoped=true&ts=true\"\nimport script from \"./SingerList.vue?vue&type=script&lang=ts\"\nexport * from \"./SingerList.vue?vue&type=script&lang=ts\"\n\nimport \"./SingerList.vue?vue&type=style&index=0&id=31f6da59&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\SCMQ\\\\project\\\\HTML\\\\mq-player-vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-31f6da59\"]])\n\nexport default __exports__"],"sourceRoot":""}