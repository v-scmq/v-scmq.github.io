(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d225467"],{e468:function(e,t,l){"use strict";l.r(t);var i=l("f2bf");const c={class:"v-row",style:{margin:"0 8px 12px 0",gap:"8px","flex-wrap":"wrap","--button-icon-size":"1.5em"}},o=Object(i["k"])("播放全部"),a=Object(i["k"])("添加到"),n=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),s=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),r=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),u=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),p=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),d=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),b=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),m=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),O=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),j=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),f=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),h=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),w=Object(i["k"])("下载"),y=Object(i["k"])("删除"),v=Object(i["k"])("导入歌曲"),k=Object(i["k"])("排序方式");function g(e,t,l,g,x,M){const C=Object(i["J"])("hl-button"),Q=Object(i["J"])("popover"),F=Object(i["J"])("text-field"),_=Object(i["J"])("table-view");return Object(i["z"])(),Object(i["h"])(i["a"],null,[Object(i["i"])("div",c,[Object(i["l"])(C,{icon:"play-select",onClick:e.playSelect},{default:Object(i["Q"])(()=>[o]),_:1},8,["onClick"]),Object(i["l"])(Q,{closeable:""},{content:Object(i["Q"])(()=>[n,s,r,u,p,d,b,m,O,j,f,h]),default:Object(i["Q"])(()=>[Object(i["l"])(C,{icon:"plus"},{default:Object(i["Q"])(()=>[a]),_:1})]),_:1}),Object(i["l"])(C,{icon:"my-download"},{default:Object(i["Q"])(()=>[w]),_:1}),Object(i["l"])(C,{icon:"trash","icon-size":"1.5em"},{default:Object(i["Q"])(()=>[y]),_:1}),Object(i["l"])(C,{icon:"multiple",onClick:t[0]||(t[0]=t=>e.multiple=!e.multiple)},{default:Object(i["Q"])(()=>[Object(i["k"])(Object(i["M"])(e.multiple?"退出批量操作":"批量操作"),1)]),_:1}),Object(i["l"])(F,{modelValue:e.inputKey,"onUpdate:modelValue":t[1]||(t[1]=t=>e.inputKey=t),placeholder:"搜索本地歌曲",onInput:e.handleMusicFilter,style:{margin:"0 0 0 auto"}},null,8,["modelValue","onInput"]),Object(i["l"])(C,{icon:"import",onClick:e.onImportButtonClicked},{default:Object(i["Q"])(()=>[v]),_:1},8,["onClick"]),Object(i["i"])("input",{type:"file",style:{display:"none"},ref:"fileChooser",multiple:"",accept:"audio/*",onChange:t[2]||(t[2]=(...t)=>e.addMusic&&e.addMusic(...t))},null,544),Object(i["l"])(C,{icon:"sort",style:{"--button-icon-size":"1.2em"}},{default:Object(i["Q"])(()=>[k]),_:1})]),Object(i["l"])(_,{style:{flex:"auto"},columns:e.columns,data:e.list,selection:e.multiple,onRowDblclick:e.playMediaList},null,8,["columns","data","selection","onRowDblclick"])],64)}var x=l("39c0"),M=l("986e"),C=l("c25e"),Q=l("297e"),F=l("d257"),_=Object(i["m"])({name:"LocalMusic",setup(){const e=Object(i["F"])(""),t=Object(i["F"])(!1),l=Object(i["D"])([]),c=[{type:"index",width:"100px"},{title:"歌曲",property:"title"},{title:"歌手",property:"singer"},{title:"专辑",property:"album"},{title:"时长",property:"duration",width:"100px"},{title:"大小",property:"size",width:"100px"}],o=Object(i["F"])(null);let a=0;const n=(e,t,l)=>{let i={path:Object(F["a"])(t.path),title:l.common.title,singer:l.common.artist,year:l.common.year,album:l.common.album,cover:"",duration:Object(F["d"])(l.format.duration),size:Object(F["f"])(2,t.size),bitrate:l.format.bitrate,sampleRate:l.format.sampleRate};if(!i.title||!i.singer){let e=Object(F["b"])(t,!0);i.title=e.title||"未知",i.singer=e.singer||"未知"}const{electron:c}=window,o=i.album||t.name,a=`${e}/${Object(F["c"])(o)}`;let n,s=c.exists(a);if(!s||(n=c.isDirectory(a))){n&&c.rmDir(a);let e=l.common.picture;(e=e&&e.length?e[0].data:null)&&(c.writeFile(a,e),i.cover=Object(F["a"])(a))}else i.cover=Object(F["a"])(a);return l=l.common=l.format=null,i},s=t=>{const l=e.value,{title:i="",album:c="",singer:o=""}=t;return i.includes(l)||c.includes(l)||o.includes(l)},r=()=>Object(M["a"])({message:"播放所选音乐",showClose:!0,type:"success"}),u=()=>{clearTimeout(u.$timer),u.$method||(u.$method=()=>{const t=a>1024;t&&C["a"].open();const i=x["b"].localMusic,c=e.value?x["a"].queryOfFilter(i,s):x["a"].queryAll(i);c.then(t=>{e.value&&(a=t.length),l.splice(0,l.length,...t)}),c.finally(t?C["a"].close:null)}),u.$timer=setTimeout(u.$method,500)},p=async e=>{let t=e.target.files;if(!t||0===t.length)return;C["a"].open();let i=[];const{electron:c}=window;if(c){let e=await c.getAppPath();e+="/picture/album",c.exists(e)||c.mkDirs(e);e:for(let o of t){for(let e of l)if(o.path===e.path)continue e;let t=await c.parseFile(o.path);i.push(n(e,o,t))}}else for(let l of t)i.push(Object(F["b"])(l,!1));i.length&&(l.push(...i),await x["a"].insert(x["b"].localMusic,i),a+=i.length),C["a"].close()};return Object(i["v"])(()=>x["a"].close()),C["a"].open(),x["a"].open().then(()=>x["a"].queryAll(x["b"].localMusic)).then(e=>a=l.push(...e)).finally(C["a"].close),{columns:c,list:l,multiple:t,inputKey:e,fileChooser:o,playSelect:r,handleMusicFilter:u,playMediaList:Q["a"],addMusic:p,onImportButtonClicked:()=>{const e=o.value;e.value=null,e.click()}}}}),z=l("6b0d"),$=l.n(z);const D=$()(_,[["render",g]]);t["default"]=D}}]);
//# sourceMappingURL=chunk-2d225467.cdfdf7a1.js.map