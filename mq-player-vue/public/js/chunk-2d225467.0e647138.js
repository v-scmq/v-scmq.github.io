(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d225467"],{e468:function(e,t,l){"use strict";l.r(t);var i=l("f2bf");const o={class:"v-row",style:{margin:"0 8px 12px 0",gap:"8px","flex-wrap":"wrap"}},c=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),n=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),a=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),s=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),r=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),p=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),u=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),d=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),m=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),b=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1),f=Object(i["i"])("div",{class:"dropdown-item separator first"},"我的收藏",-1),O=Object(i["i"])("div",{class:"dropdown-item last"},"添加到新歌单",-1);function j(e,t,l,j,h,w){const x=Object(i["J"])("Button"),y=Object(i["J"])("popover"),v=Object(i["J"])("text-field"),g=Object(i["J"])("table-view");return Object(i["z"])(),Object(i["h"])(i["a"],null,[Object(i["i"])("div",o,[Object(i["l"])(x,{text:"播放全部",prefixIcon:"play-select",prefixIconSize:"1.5em",onClick:e.playSelect},null,8,["onClick"]),Object(i["l"])(y,{closeable:""},{content:Object(i["Q"])(()=>[c,n,a,s,r,p,u,d,m,b,f,O]),default:Object(i["Q"])(()=>[Object(i["l"])(x,{text:"添加到",prefixIcon:"plus",prefixIconSize:"1.5em"})]),_:1}),Object(i["l"])(x,{text:"下载",prefixIcon:"my-download",prefixIconSize:"1.5em"}),Object(i["l"])(x,{text:"删除",prefixIcon:"trash",prefixIconSize:"1.5em"}),Object(i["l"])(x,{text:e.multiple?"退出批量操作":"批量操作",prefixIcon:"multiple",prefixIconSize:"1.5em",onClick:e.onMultiple},null,8,["text","onClick"]),Object(i["l"])(v,{modelValue:e.inputKey,"onUpdate:modelValue":t[0]||(t[0]=t=>e.inputKey=t),placeholder:"搜索本地歌曲",onInput:e.handleMusicFilter,style:{margin:"0 0 0 auto"}},null,8,["modelValue","onInput"]),Object(i["l"])(x,{text:"导入歌曲",onClick:e.onImportButtonClicked,prefixIcon:"import",prefixIconSize:"1.5em"},null,8,["onClick"]),Object(i["i"])("input",{type:"file",style:{display:"none"},ref:"fileChooser",multiple:"",accept:"audio/*",onChange:t[1]||(t[1]=(...t)=>e.addMusic&&e.addMusic(...t))},null,544),Object(i["l"])(x,{text:"排序方式",prefixIcon:"sort",prefixIconSize:"1.2em"})]),Object(i["l"])(g,{columns:e.columns,data:e.list,style:{flex:"auto"},onRowDblclick:e.playMediaList},null,8,["columns","data","onRowDblclick"])],64)}var h=l("39c0"),w=l("986e"),x=l("c25e"),y=l("297e"),v=l("d257"),g=Object(i["m"])({name:"LocalMusic",setup(){const e=Object(i["F"])(""),t=Object(i["F"])(!1),l=Object(i["D"])([]),o=Object(i["D"])([{type:"index",width:"100px"},{title:"歌曲",property:"title"},{title:"歌手",property:"singer"},{title:"专辑",property:"album"},{title:"时长",property:"duration",width:"100px"},{title:"大小",property:"size",width:"100px"}]),c=Object(i["F"])(null);let n=0;const a=(e,t,l)=>{let i={path:Object(v["a"])(t.path),title:l.common.title,singer:l.common.artist,year:l.common.year,album:l.common.album,cover:"",duration:Object(v["d"])(l.format.duration),size:Object(v["f"])(2,t.size),bitrate:l.format.bitrate,sampleRate:l.format.sampleRate};if(!i.title||!i.singer){let e=Object(v["b"])(t,!0);i.title=e.title||"未知",i.singer=e.singer||"未知"}const{electron:o}=window,c=i.album||t.name,n=`${e}/${Object(v["c"])(c)}`;let a,s=o.exists(n);if(!s||(a=o.isDirectory(n))){a&&o.rmDir(n);let e=l.common.picture;(e=e&&e.length?e[0].data:null)&&(o.writeFile(n,e),i.cover=Object(v["a"])(n))}else i.cover=Object(v["a"])(n);return l=l.common=l.format=null,i},s=t=>{const l=e.value,{title:i="",album:o="",singer:c=""}=t;return i.includes(l)||o.includes(l)||c.includes(l)},r=()=>Object(w["a"])({message:"播放所选音乐",showClose:!0,type:"success"}),p=()=>{clearTimeout(p.$timer),p.$method||(p.$method=()=>{const t=n>1024;t&&x["a"].open();const i=h["b"].localMusic,o=e.value?h["a"].queryOfFilter(i,s):h["a"].queryAll(i);o.then(t=>{e.value&&(n=t.length),l.splice(0,l.length,...t)}),o.finally(t?x["a"].close:null)}),p.$timer=setTimeout(p.$method,500)},u=async e=>{let t=e.target.files;if(!t||0===t.length)return;x["a"].open();let i=[];const{electron:o}=window;if(o){let e=await o.getAppPath();e+="/picture/album",o.exists(e)||o.mkDirs(e);e:for(let c of t){for(let e of l)if(c.path===e.path)continue e;let t=await o.parseFile(c.path);i.push(a(e,c,t))}}else for(let l of t)i.push(Object(v["b"])(l,!1));i.length&&(l.push(...i),await h["a"].insert(h["b"].localMusic,i),n+=i.length),x["a"].close()};return Object(i["v"])(()=>h["a"].close()),x["a"].open(),h["a"].open().then(()=>h["a"].queryAll(h["b"].localMusic)).then(e=>n=l.push(...e)).finally(x["a"].close),{columns:o,list:l,multiple:t,inputKey:e,fileChooser:c,playSelect:r,handleMusicFilter:p,playMediaList:y["a"],addMusic:u,onMultiple:()=>{const e=o[0];e.type="index"===e.type?"checkbox":"index",t.value=!t.value},onImportButtonClicked:()=>{const e=c.value;e.value=null,e.click()}}}}),I=l("6b0d"),k=l.n(I);const M=k()(g,[["render",j]]);t["default"]=M}}]);
//# sourceMappingURL=chunk-2d225467.0e647138.js.map