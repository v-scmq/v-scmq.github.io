import{d as de,r as p,n as _,p as Re,ct as He,cu as Te,cv as Se,c as b,a as G,f as he,Y as le,au as N,o as g,X as te,m as We,v as _e,w as we,cw as Le,b as $e,e as Ve,F as Q,g as ne,y as fe,h as ve,t as ge}from"./gvaldf4a.js";const Ne={class:"c-scrollbar"},re="end-reached",pe="resize",me="scroll",k=null,Ye=de({__name:"CScrollbar",props:{fillWidth:{},fillHeight:{}},emits:[re,pe,me],setup(m,{emit:P}){let C,R,S,H;const{max:X}=Math,d=setTimeout,I=m,W=P,f=p(k),Y=p(k),w=p(k),K=p(k),B=p(k),L=p(k),T=p({sw:0,w:0,l:0,x:!1,sh:0,h:0,t:0,y:!1}),$=_(()=>{const{sw:s,w:o,l:i,x:n}=T.value,u=n?X(o/s*100,20):0;return n?{width:`${u}%`,left:`${i/(s-o)*(100-u)}%`}:{}}),U=_(()=>{const{sh:s,h:o,t:i,y:n}=T.value,u=n?X(o/s*100,20):0;return n?{height:`${u}%`,top:`${i/(s-o)*(100-u)}%`}:{}}),j=_(()=>{let{fillWidth:s,fillHeight:o}=I;return{width:s?z(s)?`${s}px`:s:k,height:o?z(o)?`${o}px`:o:k}}),z=s=>typeof s=="number",x=()=>{const{scrollWidth:s,clientWidth:o,scrollLeft:i,scrollHeight:n,clientHeight:u,scrollTop:l}=f.value;T.value={sw:s,w:o,l:i,x:s>o,sh:n,h:u,t:l,y:n>u}},y=s=>{s.stopPropagation()},V=s=>{x(),W(me,s)},J=s=>{if(s.deltaY<=0)return;const{clientHeight:o,scrollHeight:i,scrollTop:n}=f.value;n>=i-o-1&&(C&&clearTimeout(C),C=d(()=>{C=k,W(re,re)},500))},Z=s=>{const o=f.value,i=s.currentTarget;if(i===B.value){const n=w.value.offsetHeight,u=s.offsetY-n/2,l=i.offsetHeight-n,e=o.scrollHeight-o.offsetHeight;o.scrollTop=u/l*e}if(i===L.value){const n=K.value.offsetWidth,u=s.offsetX-n/2,l=i.offsetWidth-n,e=o.scrollWidth-o.offsetWidth;o.scrollLeft=u/l*e}},A=s=>{s.stopImmediatePropagation();let o=!0;const i=document,n="onselectstart",u="mousemove",l="mouseup",e="EventListener",t=`add${e}`,a=`remove${e}`,c=i[n],h=f.value,{clientX:E,clientY:r,currentTarget:v}=s,{scrollLeft:F,scrollTop:q}=h,D=ue=>{if(o)if(v===w.value){const se=ue.clientY-r,oe=B.value.offsetHeight,ae=v.offsetHeight,ce=se/(oe-ae),ie=h.scrollHeight-h.clientHeight;h.scrollTop=q+ce*ie}else{const se=ue.clientX-E,oe=L.value.offsetWidth,ae=v.offsetWidth,ce=se/(oe-ae),ie=h.scrollWidth-h.clientWidth;h.scrollLeft=F+ce*ie}},O=()=>{o=!1,i[n]=c,i[a](u,D),i[a](l,O)};i[n]=()=>!1,i[t](u,D),i[t](l,O)};return Re(()=>{R=new ResizeObserver(()=>{x(),W(pe,f.value)}),R.observe(f.value),R.observe(Y.value)}),He(()=>{S=T.value.l,H=T.value.t}),Te(()=>(S>0||H>0)&&d(()=>{f.value.scrollTop=H,f.value.scrollLeft=S,S=H=k})),Se(()=>{R.disconnect(),R=k}),(s,o)=>(g(),b("div",Ne,[G("div",{class:"scroll-wrapper",ref_key:"scrollWrapperRef",ref:f,onScroll:V,onTouchend:J,onWheel:J},[G("div",{class:"scroll-fill",ref_key:"scrollViewRef",ref:Y,style:N(j.value)},[le(s.$slots,"default")],4),le(s.$slots,"extra")],544),T.value.x?(g(),b("div",{key:0,class:"c-track x",ref_key:"trackXRef",ref:L,onClick:Z},[G("div",{ref_key:"thumbXRef",ref:K,class:"c-thumb",style:N($.value),onMousedown:A,onClick:y},null,36)],512)):he("",!0),T.value.y?(g(),b("div",{key:1,class:"c-track y",ref_key:"trackYRef",ref:B,onClick:Z},[G("div",{ref_key:"thumbYRef",ref:w,class:"c-thumb",style:N(U.value),onMousedown:A,onClick:y},null,36)],512)):he("",!0)]))}}),ye="update:modelValue",ke=de({__name:"CCheckbox",props:{modelValue:Boolean,indeterminate:Boolean,disabled:Boolean},emits:[ye],setup(m,{emit:P}){const C=m,R=P,S=H=>{H.stopPropagation(),!C.disabled&&R(ye,!C.modelValue)};return(H,X)=>(g(),b("span",{class:te(["c-checkbox",{checked:m.modelValue,none:m.indeterminate,disabled:m.disabled}]),onClick:S},null,2))}}),Ke=["data-row"],Ae="end-reached",be="row-click",xe="row-click",ee="left",Ee="center",M="right",Ce=null,De=de({__name:"CTable",props:{cellHeight:{type:Number,default:36},selectKey:{type:String,default:"_check_"},columns:{type:Array,required:!0},data:{type:Array,required:!0}},emits:[Ae,be,xe],setup(m,{emit:P}){const C={},{ceil:R,floor:S,max:H,round:X}=Math,d=m,I=P,W=p(0),f=We([]),Y=p(-1),w=p([]),K=_(()=>d.data.length*d.cellHeight),B=_(()=>w.value.reduce((l,e)=>l+e,0)),L=_(()=>{let l="m",e=w.value,{data:t,columns:a}=d,c,h,E=a.map(r=>({...r,isChoice:h=r.type==="choice",title:(c=r.type==="index")?r.title||t.length:r.title,get:h?void 0:c?J:Z})).sort((r,v)=>(r.fixed||l).localeCompare(v.fixed||l));return E.forEach((r,v,F)=>{!r.fixed&&(F=E[v-1])?.fixed&&(F.isFixedLast=!0),!r.fixed&&(F=E[v+1])?.fixed&&(F.isFixedFirst=!0),r.fixed===ee&&(r.pos={left:`${e.reduce((q,D,O)=>q+(O<v?D:0),0)}px`}),r.fixed===M&&(r.pos={right:`${e.reduce((q,D,O)=>q+(O>v?D:0),0)}px`})}),E}),T=_(()=>({gridTemplateColumns:L.value.map(l=>l.width||"1fr").join(" ")})),$=_(()=>{let{data:l,selectKey:e}=d,t=l.reduce((c,h)=>c+(h[e]?1:0),0),a=l.length;return{checked:a===t,disabled:a<1,none:t>0&&t<a}}),U=p(Ce),j=p(!0),z=p(!0);let x=0,y,V;const J=(l,e)=>(e=++e+W.value)<10?`0${e}`:e,Z=(l,e,t)=>l[t.field],A=()=>{let l=d.data,e=l.length,{scrollLeft:t,scrollTop:a,scrollWidth:c,offsetWidth:h,offsetHeight:E}=y||C;if(j.value=t<1,z.value=X(t)>=c-h,e<=x){W.value=0,f.splice(0,f.length,...l);return}let r,v;(a=R(a))>=K.value-E?(v=e,r=v-x):(r=a/d.cellHeight^0,v=r+x),f.splice(0,f.length,...l.slice(r,v)),W.value=r},s=l=>{let{data:e,selectKey:t}=d,a,c;if(e.length){a=typeof l=="boolean"?l:!$.value.checked;for(c of e)c[t]=a}},o=l=>{let e=l.target?.closest(".cell"),t=l.detail,a=e?.dataset?.row;a&&t<2&&I(t<2?be:xe,d.data,(a^0)+W.value)},i=l=>{let e=l.key?.toUpperCase();e=="PAGEUP"&&(y.scrollTop-=d.cellHeight*x),e=="PAGEDOWN"&&(y.scrollTop+=d.cellHeight*x),e=="ARROWUP"&&(y.scrollTop-=d.cellHeight),e=="ARROWDOWN"&&(y.scrollTop+=d.cellHeight),e=="HOME"&&y.scrollTo(0,0),e=="END"&&y.scrollTo(0,K.value),e=="A"&&l.ctrlKey&&d.columns.some(t=>t.type==="choice")&&s(!$.value.checked)},n=l=>{let e=l.target;e.classList.contains("cell")||(e=e.closest(".cell"));const t=e&&e.getAttribute("data-row");Y.value=t?t^0:-1},u=l=>{y=l;const e=H(S(l.clientHeight/d.cellHeight)-1,0);x!==e&&(x=e),A()};return Re(()=>{V=new ResizeObserver(()=>{const{gridTemplateColumns:l}=getComputedStyle(U.value),e=t=>parseFloat(t)||0;w.value=l.split(" ").map(e)}),V.observe(U.value)}),_e(()=>{V&&V.disconnect(),y=V=Ce}),we(Le(d.data)?d.data:()=>d.data,A),(l,e)=>(g(),b("div",{class:te(["c-table",{[ee]:j.value,[M]:z.value}]),tabindex:"0",onKeydown:i,style:N({"--cell-height":`${m.cellHeight}px`})},[$e(Ye,{class:"table-inner","fill-width":B.value,"fill-height":K.value,onResize:u,onScroll:A,onEndReached:I},{extra:Ve(()=>[G("div",{class:"grid",ref_key:"gridRef",ref:U,style:N(T.value),onClick:o,onPointermove:n,onPointerleave:e[0]||(e[0]=t=>Y.value=-1)},[(g(!0),b(Q,null,ne(L.value,(t,a)=>(g(),b("div",{class:te(["cell th",{flex:t.flex,right:(t.thAlign||t.align)===M,center:(t.thAlign||t.align)===Ee,"fix-left":t.fixed===ee,"fix-right":t.fixed===M,end:t.isFixedLast,start:t.isFixedFirst}]),key:a,style:N(t.pos)},[t.isChoice?(g(),fe(ke,{key:0,"model-value":$.value.checked,disabled:$.value.disabled,indeterminate:$.value.none,onClick:s},null,8,["model-value","disabled","indeterminate"])):le(l.$slots,`h-${t.field}`,{key:1},()=>[ve(ge(t.title),1)])],6))),128)),(g(!0),b(Q,null,ne(f,(t,a)=>(g(),b(Q,{key:a},[(g(!0),b(Q,null,ne(L.value,(c,h)=>(g(),b("div",{class:te(["cell",{flex:c.flex,right:(c.align||c.thAlign)===M,center:(c.align||c.thAlign)===Ee,selected:t[m.selectKey],hover:Y.value===a,odd:(a&1)<1,"fix-left":c.fixed===ee,"fix-right":c.fixed===M,end:c.isFixedLast,start:c.isFixedFirst}]),key:`${a}-${h}`,"data-row":a,style:N(c.pos)},[c.isChoice?(g(),fe(ke,{key:0,modelValue:t[m.selectKey],"onUpdate:modelValue":E=>t[m.selectKey]=E},null,8,["modelValue","onUpdate:modelValue"])):le(l.$slots,c.field,{key:1,row:t,idx:a},()=>[ve(ge(c.get(t,a,c)),1)])],14,Ke))),128))],64))),128))],36)]),_:3},8,["fill-width","fill-height"])],38))}});export{De as _,ke as a};
