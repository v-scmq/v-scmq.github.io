const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["kbr1dd7a.js","e3hakuts.js","be6shyp5.css","lusim3ka.js","dgso851w.js","nsacsdt8.js","h72yjdwi.css","jxax244e.js","howdarek.css","np029d02.js","e4su9g60.js","6yira59c.css","ny6gix59.css","ep0kgyhi.css","bsnhfarp.css"])))=>i.map(i=>d[i]);
import{d as me,u as pe,r as m,m as ce,n as ve,p as fe,s as _e,w as ye,c as P,b as l,f as W,v as T,e as i,x as k,y as ge,a as r,z as we,A as be,E as Ve,B as Ee,o as c,F as G,g as H,h as C,C as xe,D as ke,G as Ce,H as J,i as _,I as Le,l as f,J as K,K as j,L as Ne,_ as u,M as he,N as Y,O as Ie,P as Re,Q as Z,R as Ae,S as Pe}from"./e3hakuts.js";import{E as Te,a as De,b as Oe}from"./jxax244e.js";import{E as Ue}from"./02hwjba9.js";import{E as Me,a as $e}from"./nsacsdt8.js";import{_ as Se}from"./l8v1l1nb.js";import{_ as Be,a as qe}from"./l09hxlu4.js";const Fe={class:"col card-item grow",style:{position:"relative"}},Ge={class:"row label-wrapper"},He={class:"row"},Xe={class:"row label-wrapper"},ze={class:"row"},Qe={key:0,class:"col c-editor"},We={class:"row"},Je={class:"label-wrapper note-props"},Ke={class:"row center"},X=null,na=me({__name:"Note",setup(je){let M="",$;const[L]=pe(),S=m(!1),y=ce(()=>S.value||!L.value),B=m(M),q=m(""),N=m(""),V=m([]),D=m(!1),ee=ve(),ae=[{type:"choice",fixed:"left",width:"32px"},{type:"index",fixed:"left",width:"100px"},{title:"分类",field:"type",width:"minmax(100px, 200px)"},{title:"名称",fixed:"left",field:"name",width:"minmax(160px, 1fr)"},{title:"公开",field:"public",width:"46px",align:"center"},{title:"创建时间",field:"create",width:"142px",align:"center"},{title:"更新时间",field:"update",width:"142px",align:"center"},{title:"操作",field:"oper",width:"94px",align:"center",fixed:"right"}],g=fe([]),O=m(!1),h=m(""),n=m({}),E=m(!1),z=m(X),F=_e(X),te={category:{required:!0,message:"必须选择一个分类"},name:[{required:!0,message:"必须输入笔记名称"},{max:32,message:"笔记名称长度不能超过32"}]},le=t=>{D.value||M===t||(M=t,D.value=!0,J(t).then(e=>{V.value=e.data||[],D.value=!1}))},oe=async()=>{_();const t=N.value.trim();N.value="";const{data:e}=await Le(t);e&&V.value.push({id:e,name:t}),f()},ne=async()=>{_();const{data:t}=await K(B.value,q.value);j(t)&&g.splice(0,g.length,...t),f()},ie=()=>{n.value={},E.value=!0},de=async()=>{try{await z.value.validate()}catch{return}E.value=!1,_();const t=n.value,{error:e,data:d}=await Ne({...t});e?f():(t.id=d,g.push(t),await Q(t))},Q=async t=>{_();try{if(!F.value){const{default:d}=await u(async()=>{const{default:a}=await import("./j76fewex.js");return{default:a}},[]),{default:s}=await u(async()=>{const{default:a}=await import("./g1lwzrok.js");return{default:a}},[]),{default:o}=await u(async()=>{const{default:a}=await import("./k5u3axtc.js");return{default:a}},[]),{default:v}=await u(async()=>{const{default:a}=await import("./kbr1dd7a.js").then(p=>p.a$);return{default:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{default:w}=await u(async()=>{const{default:a}=await import("./np029d02.js");return{default:a}},__vite__mapDeps([9,4])),{default:x}=await u(async()=>{const{default:a}=await import("./mobzba07.js");return{default:a}},[]),b=await u(()=>import("./jr8cclj6.js"),[]),{config:I,MdEditor:U}=await u(async()=>{const{config:a,MdEditor:p}=await import("./e4su9g60.js").then(R=>R.w);return{config:a,MdEditor:p}},__vite__mapDeps([10,1,2]));await u(()=>Promise.resolve({}),__vite__mapDeps([11])),await u(()=>Promise.resolve({}),__vite__mapDeps([12])),await u(()=>Promise.resolve({}),__vite__mapDeps([13])),await u(()=>Promise.resolve({}),__vite__mapDeps([14])),F.value=U,I({editorExtensions:{prettier:{prettierInstance:x,parserMarkdownInstance:b},highlight:{instance:w},screenfull:{instance:d},katex:{instance:s},cropper:{instance:o},mermaid:{instance:v}},codeMirrorExtensions(a){const R=A=>A.slice(0,100);return a.map(A=>A.type==="linkShortener"?{...A,options:{maxLength:100,shortenText:R}}:A)}})}n.value={...t},$=t,h.value="",O.value=!0;const{data:e}=await he(t.id);h.value=e||""}catch{Y("Markdown组件加载失败，请稍后重试！")}f()},se=async(t,e)=>{if(t.some(o=>o.size>4194306))return Y("图片大小不得超过4MB！");_();const s=n.value.id;for(const o of t){const{error:v,data:w}=await Ie(s,o);if(v)break;e([`/services/apexrest/note/image?id=${s}&pid=${w}`])}f()},re=async()=>{_();let t=n.value,{id:e,category:d,name:s,public:o}=n.value,{category:v,name:w,public:x}=$,b=[d,s=s?.trim(),o],I=[v,w,x];if(b.some((a,p)=>a!==I[p])){const{error:a}=await Re({id:e,category:d,name:s,isPublic:o});if(a)return f();t.name=s,Z($,{category:d,name:s,public:o})}await Ae(e,h.value.trim()),f()},ue=async(t,e)=>{if(L.value){_();const{error:d}=await Pe(t.id);!d&&g.splice(e,1),f()}};return ye(L,async t=>{_(),S.value=!0;let e=t?await J():X,{data:d}=await K(),s=n.value;V.value=e?e.data:[],j(d)&&g.splice(0,g.length,...d),O.value&&Z(s,d.find(o=>o.id===o.id)),S.value=!1,f()},{immediate:!0}),(t,e)=>{const d=$e,s=be,o=Ve,v=Me,w=Te,x=Ue,b=Oe,I=De,U=Ee;return c(),P("div",Fe,[l(Se,{"min-width":600,"media-width":k(ee)},{default:i(()=>[r("div",Ge,[e[14]||(e[14]=r("span",{class:"label"},"分类",-1)),l(v,{remote:"",filterable:"",placeholder:"全部",modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=a=>B.value=a),"remote-method":le,loading:D.value,disabled:y.value},{footer:i(()=>[r("div",He,[l(s,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),style:{flex:"1"}},null,8,["modelValue"]),l(o,{type:"primary",disabled:!N.value,onClick:oe},{default:i(()=>e[13]||(e[13]=[C("添加")])),_:1},8,["disabled"])])]),default:i(()=>[l(d,{label:"全部",value:""}),(c(!0),P(G,null,H(V.value,a=>(c(),T(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),r("div",Xe,[e[15]||(e[15]=r("span",{class:"label"},"名称",-1)),l(s,{placeholder:"请输入名称",modelValue:q.value,"onUpdate:modelValue":e[2]||(e[2]=a=>q.value=a),disabled:y.value},null,8,["modelValue","disabled"])]),l(o,{type:"primary",onClick:ne},{default:i(()=>e[16]||(e[16]=[C("检索")])),_:1})]),_:1},8,["media-width"]),l(Be,{columns:ae,data:g,"cell-height":48},ge({public:i(({row:a})=>[l(qe,{disabled:"",modelValue:a.public,"onUpdate:modelValue":p=>a.public=p},null,8,["modelValue","onUpdate:modelValue"])]),oper:i(({row:a,idx:p})=>[r("div",ze,[l(o,{type:"primary",circle:"",icon:k(ke),onClick:R=>Q(a)},null,8,["icon","onClick"]),l(w,{width:"256",title:"确定删除吗，删除后将无法恢复？",onConfirm:R=>ue(a,p)},{reference:i(()=>[l(o,{type:"danger",circle:"",icon:k(Ce),disabled:y.value},null,8,["icon","disabled"])]),_:2},1032,["onConfirm"])])]),_:2},[k(L)?{name:"h-oper",fn:i(()=>[l(o,{type:"success",circle:"",icon:k(xe),onClick:ie},null,8,["icon"])]),key:"0"}:void 0]),1032,["data"]),O.value?(c(),P("div",Qe,[r("div",We,[l(o,{round:"",type:"success",onClick:e[3]||(e[3]=a=>O.value=!1)},{default:i(()=>e[17]||(e[17]=[C("返回")])),_:1}),l(o,{round:"",type:"primary",disabled:y.value,onClick:re},{default:i(()=>e[18]||(e[18]=[C("保存")])),_:1},8,["disabled"]),r("div",Je,[e[19]||(e[19]=r("div",{class:"label"},"分类",-1)),l(v,{modelValue:n.value.category,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.category=a),disabled:y.value},{default:i(()=>[(c(!0),P(G,null,H(V.value,a=>(c(),T(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e[20]||(e[20]=r("div",{class:"label"},"名称",-1)),l(s,{placeholder:"请输入笔记名称",modelValue:n.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.name=a),disabled:y.value},null,8,["modelValue","disabled"]),e[21]||(e[21]=r("div",{class:"label"},"公开",-1)),l(x,{modelValue:n.value.public,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.public=a),disabled:y.value},null,8,["modelValue","disabled"])])]),(c(),T(we(F.value),{noEcharts:"",modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),toolbarsExclude:["save","htmlPreview","github"],onOnUploadImg:se},null,40,["modelValue"]))])):W("",!0),k(L)&&E.value?(c(),T(U,{key:1,width:"460","align-center":"",title:"添加笔记",modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=a=>E.value=a)},{default:i(()=>[l(I,{"label-position":"right","label-width":"60px",ref_key:"formRef",ref:z,model:n.value,rules:te},{default:i(()=>[l(b,{label:"分类",prop:"category"},{default:i(()=>[l(v,{modelValue:n.value.category,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.category=a)},{default:i(()=>[(c(!0),P(G,null,H(V.value,a=>(c(),T(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"名称",prop:"name"},{default:i(()=>[l(s,{modelValue:n.value.name,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"公开",prop:"public"},{default:i(()=>[l(x,{modelValue:n.value.public,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.public=a)},null,8,["modelValue"])]),_:1}),r("div",Ke,[l(o,{type:"primary",onClick:de},{default:i(()=>e[22]||(e[22]=[C("添加")])),_:1}),l(o,{type:"primary",onClick:e[11]||(e[11]=a=>E.value=!1)},{default:i(()=>e[23]||(e[23]=[C("取消")])),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"])):W("",!0)])}}});export{na as default};
